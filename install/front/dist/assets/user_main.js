import{B as v,u as y,N as S,g as A,a as D,T,r as hi,m as Q,h as M,M as ze,P as Mt,I as $e,f as yt,b as He,c as dt,d as ui,G as di,t as xe,D as mi,L as fi,R as ue,e as pi,i as gi,S as vi,j as yi,k as wi,l as bi,n as xi,C as ki}from"./main.js";var Qt,Kt;Kt=v();Qt=v();function Mi(){return{view:function({attrs:r}){return m("",[location.href.match("o-o.zone")||location.href.match("o-o.space")?m(v,"该功能仅限【技术宅】使用，若您访问的是【喵宅苑】，将无法登录。"):void 0,m("",{style:{display:"grid",gridTemplateColumns:"8rem 1fr",gridTemplateRows:"1fr 1fr 1fr"}},[m(v,"用户名"),m(Kt,{tagName:"input[type=text]"}),m(v,"密码"),m(Qt,{tagName:"input[type=password]"}),m("",""),m("",[m(v,{color:"red",isBtn:!0,onclick:async()=>{var t;try{return await y.dzLogin(Kt.data.value,Qt.data.value)}catch(i){return t=i,console.dir(t)}}},"登录"),m(v,{isBtn:!0,onclick:()=>r.delete()},"取消")])])])}}}/*!
 * Cropper.js v1.6.1
 * https://fengyuanchen.github.io/cropperjs
 *
 * Copyright 2015-present Chen Fengyuan
 * Released under the MIT license
 *
 * Date: 2023-09-17T03:44:19.860Z
 */function ke(r,t){var i=Object.keys(r);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(r);t&&(e=e.filter(function(n){return Object.getOwnPropertyDescriptor(r,n).enumerable})),i.push.apply(i,e)}return i}function Ye(r){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?ke(Object(i),!0).forEach(function(e){Ci(r,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):ke(Object(i)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(i,e))})}return r}function Zt(r){"@babel/helpers - typeof";return Zt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Zt(r)}function Di(r,t){if(!(r instanceof t))throw new TypeError("Cannot call a class as a function")}function Me(r,t){for(var i=0;i<t.length;i++){var e=t[i];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(r,Ue(e.key),e)}}function Ti(r,t,i){return t&&Me(r.prototype,t),i&&Me(r,i),Object.defineProperty(r,"prototype",{writable:!1}),r}function Ci(r,t,i){return t=Ue(t),t in r?Object.defineProperty(r,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[t]=i,r}function We(r){return Bi(r)||Ei(r)||Ri(r)||Si()}function Bi(r){if(Array.isArray(r))return Jt(r)}function Ei(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function Ri(r,t){if(r){if(typeof r=="string")return Jt(r,t);var i=Object.prototype.toString.call(r).slice(8,-1);if(i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set")return Array.from(r);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Jt(r,t)}}function Jt(r,t){(t==null||t>r.length)&&(t=r.length);for(var i=0,e=new Array(t);i<t;i++)e[i]=r[i];return e}function Si(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ii(r,t){if(typeof r!="object"||r===null)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var e=i.call(r,t);if(typeof e!="object")return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}function Ue(r){var t=Ii(r,"string");return typeof t=="symbol"?t:String(t)}var Gt=typeof window<"u"&&typeof window.document<"u",it=Gt?window:{},de=Gt&&it.document.documentElement?"ontouchstart"in it.document.documentElement:!1,me=Gt?"PointerEvent"in it:!1,I="cropper",fe="all",Xe="crop",je="move",Ge="zoom",lt="e",ct="w",gt="s",rt="n",Et="ne",Rt="nw",St="se",It="sw",te="".concat(I,"-crop"),De="".concat(I,"-disabled"),W="".concat(I,"-hidden"),Te="".concat(I,"-hide"),_i="".concat(I,"-invisible"),jt="".concat(I,"-modal"),ee="".concat(I,"-move"),Lt="".concat(I,"Action"),Yt="".concat(I,"Preview"),pe="crop",Ve="move",Fe="none",ie="crop",re="cropend",ae="cropmove",ne="cropstart",Ce="dblclick",Ni=de?"touchstart":"mousedown",Oi=de?"touchmove":"mousemove",Ai=de?"touchend touchcancel":"mouseup",Be=me?"pointerdown":Ni,Ee=me?"pointermove":Oi,Re=me?"pointerup pointercancel":Ai,Se="ready",Ie="resize",_e="wheel",oe="zoom",Ne="image/jpeg",Pi=/^e|w|s|n|se|sw|ne|nw|all|crop|move|zoom$/,Li=/^data:/,zi=/^data:image\/jpeg;base64,/,$i=/^img|canvas$/i,qe=200,Qe=100,Oe={viewMode:0,dragMode:pe,initialAspectRatio:NaN,aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:qe,minContainerHeight:Qe,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},Hi='<div class="cropper-container" touch-action="none"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-cropper-action="e"></span><span class="cropper-line line-n" data-cropper-action="n"></span><span class="cropper-line line-w" data-cropper-action="w"></span><span class="cropper-line line-s" data-cropper-action="s"></span><span class="cropper-point point-e" data-cropper-action="e"></span><span class="cropper-point point-n" data-cropper-action="n"></span><span class="cropper-point point-w" data-cropper-action="w"></span><span class="cropper-point point-s" data-cropper-action="s"></span><span class="cropper-point point-ne" data-cropper-action="ne"></span><span class="cropper-point point-nw" data-cropper-action="nw"></span><span class="cropper-point point-sw" data-cropper-action="sw"></span><span class="cropper-point point-se" data-cropper-action="se"></span></div></div>',Yi=Number.isNaN||it.isNaN;function B(r){return typeof r=="number"&&!Yi(r)}var Ae=function(t){return t>0&&t<1/0};function Vt(r){return typeof r>"u"}function mt(r){return Zt(r)==="object"&&r!==null}var Wi=Object.prototype.hasOwnProperty;function wt(r){if(!mt(r))return!1;try{var t=r.constructor,i=t.prototype;return t&&i&&Wi.call(i,"isPrototypeOf")}catch{return!1}}function Y(r){return typeof r=="function"}var Ui=Array.prototype.slice;function Ke(r){return Array.from?Array.from(r):Ui.call(r)}function P(r,t){return r&&Y(t)&&(Array.isArray(r)||B(r.length)?Ke(r).forEach(function(i,e){t.call(r,i,e,r)}):mt(r)&&Object.keys(r).forEach(function(i){t.call(r,r[i],i,r)})),r}var _=Object.assign||function(t){for(var i=arguments.length,e=new Array(i>1?i-1:0),n=1;n<i;n++)e[n-1]=arguments[n];return mt(t)&&e.length>0&&e.forEach(function(a){mt(a)&&Object.keys(a).forEach(function(o){t[o]=a[o]})}),t},Xi=/\.\d*(?:0|9){12}\d*$/;function xt(r){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e11;return Xi.test(r)?Math.round(r*t)/t:r}var ji=/^width|height|left|top|marginLeft|marginTop$/;function nt(r,t){var i=r.style;P(t,function(e,n){ji.test(n)&&B(e)&&(e="".concat(e,"px")),i[n]=e})}function Gi(r,t){return r.classList?r.classList.contains(t):r.className.indexOf(t)>-1}function L(r,t){if(t){if(B(r.length)){P(r,function(e){L(e,t)});return}if(r.classList){r.classList.add(t);return}var i=r.className.trim();i?i.indexOf(t)<0&&(r.className="".concat(i," ").concat(t)):r.className=t}}function et(r,t){if(t){if(B(r.length)){P(r,function(i){et(i,t)});return}if(r.classList){r.classList.remove(t);return}r.className.indexOf(t)>=0&&(r.className=r.className.replace(t,""))}}function bt(r,t,i){if(t){if(B(r.length)){P(r,function(e){bt(e,t,i)});return}i?L(r,t):et(r,t)}}var Vi=/([a-z\d])([A-Z])/g;function ge(r){return r.replace(Vi,"$1-$2").toLowerCase()}function se(r,t){return mt(r[t])?r[t]:r.dataset?r.dataset[t]:r.getAttribute("data-".concat(ge(t)))}function zt(r,t,i){mt(i)?r[t]=i:r.dataset?r.dataset[t]=i:r.setAttribute("data-".concat(ge(t)),i)}function Fi(r,t){if(mt(r[t]))try{delete r[t]}catch{r[t]=void 0}else if(r.dataset)try{delete r.dataset[t]}catch{r.dataset[t]=void 0}else r.removeAttribute("data-".concat(ge(t)))}var Ze=/\s\s*/,Je=function(){var r=!1;if(Gt){var t=!1,i=function(){},e=Object.defineProperty({},"once",{get:function(){return r=!0,t},set:function(a){t=a}});it.addEventListener("test",i,e),it.removeEventListener("test",i,e)}return r}();function q(r,t,i){var e=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},n=i;t.trim().split(Ze).forEach(function(a){if(!Je){var o=r.listeners;o&&o[a]&&o[a][i]&&(n=o[a][i],delete o[a][i],Object.keys(o[a]).length===0&&delete o[a],Object.keys(o).length===0&&delete r.listeners)}r.removeEventListener(a,n,e)})}function V(r,t,i){var e=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},n=i;t.trim().split(Ze).forEach(function(a){if(e.once&&!Je){var o=r.listeners,s=o===void 0?{}:o;n=function(){delete s[a][i],r.removeEventListener(a,n,e);for(var h=arguments.length,l=new Array(h),c=0;c<h;c++)l[c]=arguments[c];i.apply(r,l)},s[a]||(s[a]={}),s[a][i]&&r.removeEventListener(a,s[a][i],e),s[a][i]=n,r.listeners=s}r.addEventListener(a,n,e)})}function kt(r,t,i){var e;return Y(Event)&&Y(CustomEvent)?e=new CustomEvent(t,{detail:i,bubbles:!0,cancelable:!0}):(e=document.createEvent("CustomEvent"),e.initCustomEvent(t,!0,!0,i)),r.dispatchEvent(e)}function ti(r){var t=r.getBoundingClientRect();return{left:t.left+(window.pageXOffset-document.documentElement.clientLeft),top:t.top+(window.pageYOffset-document.documentElement.clientTop)}}var Ft=it.location,qi=/^(\w+:)\/\/([^:/?#]*):?(\d*)/i;function Pe(r){var t=r.match(qi);return t!==null&&(t[1]!==Ft.protocol||t[2]!==Ft.hostname||t[3]!==Ft.port)}function Le(r){var t="timestamp=".concat(new Date().getTime());return r+(r.indexOf("?")===-1?"?":"&")+t}function Pt(r){var t=r.rotate,i=r.scaleX,e=r.scaleY,n=r.translateX,a=r.translateY,o=[];B(n)&&n!==0&&o.push("translateX(".concat(n,"px)")),B(a)&&a!==0&&o.push("translateY(".concat(a,"px)")),B(t)&&t!==0&&o.push("rotate(".concat(t,"deg)")),B(i)&&i!==1&&o.push("scaleX(".concat(i,")")),B(e)&&e!==1&&o.push("scaleY(".concat(e,")"));var s=o.length?o.join(" "):"none";return{WebkitTransform:s,msTransform:s,transform:s}}function Qi(r){var t=Ye({},r),i=0;return P(r,function(e,n){delete t[n],P(t,function(a){var o=Math.abs(e.startX-a.startX),s=Math.abs(e.startY-a.startY),d=Math.abs(e.endX-a.endX),h=Math.abs(e.endY-a.endY),l=Math.sqrt(o*o+s*s),c=Math.sqrt(d*d+h*h),u=(c-l)/l;Math.abs(u)>Math.abs(i)&&(i=u)})}),i}function Wt(r,t){var i=r.pageX,e=r.pageY,n={endX:i,endY:e};return t?n:Ye({startX:i,startY:e},n)}function Ki(r){var t=0,i=0,e=0;return P(r,function(n){var a=n.startX,o=n.startY;t+=a,i+=o,e+=1}),t/=e,i/=e,{pageX:t,pageY:i}}function ot(r){var t=r.aspectRatio,i=r.height,e=r.width,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"contain",a=Ae(e),o=Ae(i);if(a&&o){var s=i*t;n==="contain"&&s>e||n==="cover"&&s<e?i=e/t:e=i*t}else a?i=e/t:o&&(e=i*t);return{width:e,height:i}}function Zi(r){var t=r.width,i=r.height,e=r.degree;if(e=Math.abs(e)%180,e===90)return{width:i,height:t};var n=e%90*Math.PI/180,a=Math.sin(n),o=Math.cos(n),s=t*o+i*a,d=t*a+i*o;return e>90?{width:d,height:s}:{width:s,height:d}}function Ji(r,t,i,e){var n=t.aspectRatio,a=t.naturalWidth,o=t.naturalHeight,s=t.rotate,d=s===void 0?0:s,h=t.scaleX,l=h===void 0?1:h,c=t.scaleY,u=c===void 0?1:c,w=i.aspectRatio,f=i.naturalWidth,k=i.naturalHeight,x=e.fillColor,b=x===void 0?"transparent":x,R=e.imageSmoothingEnabled,C=R===void 0?!0:R,X=e.imageSmoothingQuality,$=X===void 0?"low":X,g=e.maxWidth,E=g===void 0?1/0:g,N=e.maxHeight,H=N===void 0?1/0:N,j=e.minWidth,K=j===void 0?0:j,Z=e.minHeight,F=Z===void 0?0:Z,U=document.createElement("canvas"),z=U.getContext("2d"),J=ot({aspectRatio:w,width:E,height:H}),st=ot({aspectRatio:w,width:K,height:F},"cover"),ft=Math.min(J.width,Math.max(st.width,f)),pt=Math.min(J.height,Math.max(st.height,k)),Dt=ot({aspectRatio:n,width:E,height:H}),Tt=ot({aspectRatio:n,width:K,height:F},"cover"),Ct=Math.min(Dt.width,Math.max(Tt.width,a)),Bt=Math.min(Dt.height,Math.max(Tt.height,o)),$t=[-Ct/2,-Bt/2,Ct,Bt];return U.width=xt(ft),U.height=xt(pt),z.fillStyle=b,z.fillRect(0,0,ft,pt),z.save(),z.translate(ft/2,pt/2),z.rotate(d*Math.PI/180),z.scale(l,u),z.imageSmoothingEnabled=C,z.imageSmoothingQuality=$,z.drawImage.apply(z,[r].concat(We($t.map(function(Ht){return Math.floor(xt(Ht))})))),z.restore(),U}var ei=String.fromCharCode;function tr(r,t,i){var e="";i+=t;for(var n=t;n<i;n+=1)e+=ei(r.getUint8(n));return e}var er=/^data:.*,/;function ir(r){var t=r.replace(er,""),i=atob(t),e=new ArrayBuffer(i.length),n=new Uint8Array(e);return P(n,function(a,o){n[o]=i.charCodeAt(o)}),e}function rr(r,t){for(var i=[],e=8192,n=new Uint8Array(r);n.length>0;)i.push(ei.apply(null,Ke(n.subarray(0,e)))),n=n.subarray(e);return"data:".concat(t,";base64,").concat(btoa(i.join("")))}function ar(r){var t=new DataView(r),i;try{var e,n,a;if(t.getUint8(0)===255&&t.getUint8(1)===216)for(var o=t.byteLength,s=2;s+1<o;){if(t.getUint8(s)===255&&t.getUint8(s+1)===225){n=s;break}s+=1}if(n){var d=n+4,h=n+10;if(tr(t,d,4)==="Exif"){var l=t.getUint16(h);if(e=l===18761,(e||l===19789)&&t.getUint16(h+2,e)===42){var c=t.getUint32(h+4,e);c>=8&&(a=h+c)}}}if(a){var u=t.getUint16(a,e),w,f;for(f=0;f<u;f+=1)if(w=a+f*12+2,t.getUint16(w,e)===274){w+=8,i=t.getUint16(w,e),t.setUint16(w,1,e);break}}}catch{i=1}return i}function nr(r){var t=0,i=1,e=1;switch(r){case 2:i=-1;break;case 3:t=-180;break;case 4:e=-1;break;case 5:t=90,e=-1;break;case 6:t=90;break;case 7:t=90,i=-1;break;case 8:t=-90;break}return{rotate:t,scaleX:i,scaleY:e}}var or={render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.cropped&&this.renderCropBox()},initContainer:function(){var t=this.element,i=this.options,e=this.container,n=this.cropper,a=Number(i.minContainerWidth),o=Number(i.minContainerHeight);L(n,W),et(t,W);var s={width:Math.max(e.offsetWidth,a>=0?a:qe),height:Math.max(e.offsetHeight,o>=0?o:Qe)};this.containerData=s,nt(n,{width:s.width,height:s.height}),L(t,W),et(n,W)},initCanvas:function(){var t=this.containerData,i=this.imageData,e=this.options.viewMode,n=Math.abs(i.rotate)%180===90,a=n?i.naturalHeight:i.naturalWidth,o=n?i.naturalWidth:i.naturalHeight,s=a/o,d=t.width,h=t.height;t.height*s>t.width?e===3?d=t.height*s:h=t.width/s:e===3?h=t.width/s:d=t.height*s;var l={aspectRatio:s,naturalWidth:a,naturalHeight:o,width:d,height:h};this.canvasData=l,this.limited=e===1||e===2,this.limitCanvas(!0,!0),l.width=Math.min(Math.max(l.width,l.minWidth),l.maxWidth),l.height=Math.min(Math.max(l.height,l.minHeight),l.maxHeight),l.left=(t.width-l.width)/2,l.top=(t.height-l.height)/2,l.oldLeft=l.left,l.oldTop=l.top,this.initialCanvasData=_({},l)},limitCanvas:function(t,i){var e=this.options,n=this.containerData,a=this.canvasData,o=this.cropBoxData,s=e.viewMode,d=a.aspectRatio,h=this.cropped&&o;if(t){var l=Number(e.minCanvasWidth)||0,c=Number(e.minCanvasHeight)||0;s>1?(l=Math.max(l,n.width),c=Math.max(c,n.height),s===3&&(c*d>l?l=c*d:c=l/d)):s>0&&(l?l=Math.max(l,h?o.width:0):c?c=Math.max(c,h?o.height:0):h&&(l=o.width,c=o.height,c*d>l?l=c*d:c=l/d));var u=ot({aspectRatio:d,width:l,height:c});l=u.width,c=u.height,a.minWidth=l,a.minHeight=c,a.maxWidth=1/0,a.maxHeight=1/0}if(i)if(s>(h?0:1)){var w=n.width-a.width,f=n.height-a.height;a.minLeft=Math.min(0,w),a.minTop=Math.min(0,f),a.maxLeft=Math.max(0,w),a.maxTop=Math.max(0,f),h&&this.limited&&(a.minLeft=Math.min(o.left,o.left+(o.width-a.width)),a.minTop=Math.min(o.top,o.top+(o.height-a.height)),a.maxLeft=o.left,a.maxTop=o.top,s===2&&(a.width>=n.width&&(a.minLeft=Math.min(0,w),a.maxLeft=Math.max(0,w)),a.height>=n.height&&(a.minTop=Math.min(0,f),a.maxTop=Math.max(0,f))))}else a.minLeft=-a.width,a.minTop=-a.height,a.maxLeft=n.width,a.maxTop=n.height},renderCanvas:function(t,i){var e=this.canvasData,n=this.imageData;if(i){var a=Zi({width:n.naturalWidth*Math.abs(n.scaleX||1),height:n.naturalHeight*Math.abs(n.scaleY||1),degree:n.rotate||0}),o=a.width,s=a.height,d=e.width*(o/e.naturalWidth),h=e.height*(s/e.naturalHeight);e.left-=(d-e.width)/2,e.top-=(h-e.height)/2,e.width=d,e.height=h,e.aspectRatio=o/s,e.naturalWidth=o,e.naturalHeight=s,this.limitCanvas(!0,!1)}(e.width>e.maxWidth||e.width<e.minWidth)&&(e.left=e.oldLeft),(e.height>e.maxHeight||e.height<e.minHeight)&&(e.top=e.oldTop),e.width=Math.min(Math.max(e.width,e.minWidth),e.maxWidth),e.height=Math.min(Math.max(e.height,e.minHeight),e.maxHeight),this.limitCanvas(!1,!0),e.left=Math.min(Math.max(e.left,e.minLeft),e.maxLeft),e.top=Math.min(Math.max(e.top,e.minTop),e.maxTop),e.oldLeft=e.left,e.oldTop=e.top,nt(this.canvas,_({width:e.width,height:e.height},Pt({translateX:e.left,translateY:e.top}))),this.renderImage(t),this.cropped&&this.limited&&this.limitCropBox(!0,!0)},renderImage:function(t){var i=this.canvasData,e=this.imageData,n=e.naturalWidth*(i.width/i.naturalWidth),a=e.naturalHeight*(i.height/i.naturalHeight);_(e,{width:n,height:a,left:(i.width-n)/2,top:(i.height-a)/2}),nt(this.image,_({width:e.width,height:e.height},Pt(_({translateX:e.left,translateY:e.top},e)))),t&&this.output()},initCropBox:function(){var t=this.options,i=this.canvasData,e=t.aspectRatio||t.initialAspectRatio,n=Number(t.autoCropArea)||.8,a={width:i.width,height:i.height};e&&(i.height*e>i.width?a.height=a.width/e:a.width=a.height*e),this.cropBoxData=a,this.limitCropBox(!0,!0),a.width=Math.min(Math.max(a.width,a.minWidth),a.maxWidth),a.height=Math.min(Math.max(a.height,a.minHeight),a.maxHeight),a.width=Math.max(a.minWidth,a.width*n),a.height=Math.max(a.minHeight,a.height*n),a.left=i.left+(i.width-a.width)/2,a.top=i.top+(i.height-a.height)/2,a.oldLeft=a.left,a.oldTop=a.top,this.initialCropBoxData=_({},a)},limitCropBox:function(t,i){var e=this.options,n=this.containerData,a=this.canvasData,o=this.cropBoxData,s=this.limited,d=e.aspectRatio;if(t){var h=Number(e.minCropBoxWidth)||0,l=Number(e.minCropBoxHeight)||0,c=s?Math.min(n.width,a.width,a.width+a.left,n.width-a.left):n.width,u=s?Math.min(n.height,a.height,a.height+a.top,n.height-a.top):n.height;h=Math.min(h,n.width),l=Math.min(l,n.height),d&&(h&&l?l*d>h?l=h/d:h=l*d:h?l=h/d:l&&(h=l*d),u*d>c?u=c/d:c=u*d),o.minWidth=Math.min(h,c),o.minHeight=Math.min(l,u),o.maxWidth=c,o.maxHeight=u}i&&(s?(o.minLeft=Math.max(0,a.left),o.minTop=Math.max(0,a.top),o.maxLeft=Math.min(n.width,a.left+a.width)-o.width,o.maxTop=Math.min(n.height,a.top+a.height)-o.height):(o.minLeft=0,o.minTop=0,o.maxLeft=n.width-o.width,o.maxTop=n.height-o.height))},renderCropBox:function(){var t=this.options,i=this.containerData,e=this.cropBoxData;(e.width>e.maxWidth||e.width<e.minWidth)&&(e.left=e.oldLeft),(e.height>e.maxHeight||e.height<e.minHeight)&&(e.top=e.oldTop),e.width=Math.min(Math.max(e.width,e.minWidth),e.maxWidth),e.height=Math.min(Math.max(e.height,e.minHeight),e.maxHeight),this.limitCropBox(!1,!0),e.left=Math.min(Math.max(e.left,e.minLeft),e.maxLeft),e.top=Math.min(Math.max(e.top,e.minTop),e.maxTop),e.oldLeft=e.left,e.oldTop=e.top,t.movable&&t.cropBoxMovable&&zt(this.face,Lt,e.width>=i.width&&e.height>=i.height?je:fe),nt(this.cropBox,_({width:e.width,height:e.height},Pt({translateX:e.left,translateY:e.top}))),this.cropped&&this.limited&&this.limitCanvas(!0,!0),this.disabled||this.output()},output:function(){this.preview(),kt(this.element,ie,this.getData())}},sr={initPreview:function(){var t=this.element,i=this.crossOrigin,e=this.options.preview,n=i?this.crossOriginUrl:this.url,a=t.alt||"The image to preview",o=document.createElement("img");if(i&&(o.crossOrigin=i),o.src=n,o.alt=a,this.viewBox.appendChild(o),this.viewBoxImage=o,!!e){var s=e;typeof e=="string"?s=t.ownerDocument.querySelectorAll(e):e.querySelector&&(s=[e]),this.previews=s,P(s,function(d){var h=document.createElement("img");zt(d,Yt,{width:d.offsetWidth,height:d.offsetHeight,html:d.innerHTML}),i&&(h.crossOrigin=i),h.src=n,h.alt=a,h.style.cssText='display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"',d.innerHTML="",d.appendChild(h)})}},resetPreview:function(){P(this.previews,function(t){var i=se(t,Yt);nt(t,{width:i.width,height:i.height}),t.innerHTML=i.html,Fi(t,Yt)})},preview:function(){var t=this.imageData,i=this.canvasData,e=this.cropBoxData,n=e.width,a=e.height,o=t.width,s=t.height,d=e.left-i.left-t.left,h=e.top-i.top-t.top;!this.cropped||this.disabled||(nt(this.viewBoxImage,_({width:o,height:s},Pt(_({translateX:-d,translateY:-h},t)))),P(this.previews,function(l){var c=se(l,Yt),u=c.width,w=c.height,f=u,k=w,x=1;n&&(x=u/n,k=a*x),a&&k>w&&(x=w/a,f=n*x,k=w),nt(l,{width:f,height:k}),nt(l.getElementsByTagName("img")[0],_({width:o*x,height:s*x},Pt(_({translateX:-d*x,translateY:-h*x},t))))}))}},lr={bind:function(){var t=this.element,i=this.options,e=this.cropper;Y(i.cropstart)&&V(t,ne,i.cropstart),Y(i.cropmove)&&V(t,ae,i.cropmove),Y(i.cropend)&&V(t,re,i.cropend),Y(i.crop)&&V(t,ie,i.crop),Y(i.zoom)&&V(t,oe,i.zoom),V(e,Be,this.onCropStart=this.cropStart.bind(this)),i.zoomable&&i.zoomOnWheel&&V(e,_e,this.onWheel=this.wheel.bind(this),{passive:!1,capture:!0}),i.toggleDragModeOnDblclick&&V(e,Ce,this.onDblclick=this.dblclick.bind(this)),V(t.ownerDocument,Ee,this.onCropMove=this.cropMove.bind(this)),V(t.ownerDocument,Re,this.onCropEnd=this.cropEnd.bind(this)),i.responsive&&V(window,Ie,this.onResize=this.resize.bind(this))},unbind:function(){var t=this.element,i=this.options,e=this.cropper;Y(i.cropstart)&&q(t,ne,i.cropstart),Y(i.cropmove)&&q(t,ae,i.cropmove),Y(i.cropend)&&q(t,re,i.cropend),Y(i.crop)&&q(t,ie,i.crop),Y(i.zoom)&&q(t,oe,i.zoom),q(e,Be,this.onCropStart),i.zoomable&&i.zoomOnWheel&&q(e,_e,this.onWheel,{passive:!1,capture:!0}),i.toggleDragModeOnDblclick&&q(e,Ce,this.onDblclick),q(t.ownerDocument,Ee,this.onCropMove),q(t.ownerDocument,Re,this.onCropEnd),i.responsive&&q(window,Ie,this.onResize)}},cr={resize:function(){if(!this.disabled){var t=this.options,i=this.container,e=this.containerData,n=i.offsetWidth/e.width,a=i.offsetHeight/e.height,o=Math.abs(n-1)>Math.abs(a-1)?n:a;if(o!==1){var s,d;t.restore&&(s=this.getCanvasData(),d=this.getCropBoxData()),this.render(),t.restore&&(this.setCanvasData(P(s,function(h,l){s[l]=h*o})),this.setCropBoxData(P(d,function(h,l){d[l]=h*o})))}}},dblclick:function(){this.disabled||this.options.dragMode===Fe||this.setDragMode(Gi(this.dragBox,te)?Ve:pe)},wheel:function(t){var i=this,e=Number(this.options.wheelZoomRatio)||.1,n=1;this.disabled||(t.preventDefault(),!this.wheeling&&(this.wheeling=!0,setTimeout(function(){i.wheeling=!1},50),t.deltaY?n=t.deltaY>0?1:-1:t.wheelDelta?n=-t.wheelDelta/120:t.detail&&(n=t.detail>0?1:-1),this.zoom(-n*e,t)))},cropStart:function(t){var i=t.buttons,e=t.button;if(!(this.disabled||(t.type==="mousedown"||t.type==="pointerdown"&&t.pointerType==="mouse")&&(B(i)&&i!==1||B(e)&&e!==0||t.ctrlKey))){var n=this.options,a=this.pointers,o;t.changedTouches?P(t.changedTouches,function(s){a[s.identifier]=Wt(s)}):a[t.pointerId||0]=Wt(t),Object.keys(a).length>1&&n.zoomable&&n.zoomOnTouch?o=Ge:o=se(t.target,Lt),Pi.test(o)&&kt(this.element,ne,{originalEvent:t,action:o})!==!1&&(t.preventDefault(),this.action=o,this.cropping=!1,o===Xe&&(this.cropping=!0,L(this.dragBox,jt)))}},cropMove:function(t){var i=this.action;if(!(this.disabled||!i)){var e=this.pointers;t.preventDefault(),kt(this.element,ae,{originalEvent:t,action:i})!==!1&&(t.changedTouches?P(t.changedTouches,function(n){_(e[n.identifier]||{},Wt(n,!0))}):_(e[t.pointerId||0]||{},Wt(t,!0)),this.change(t))}},cropEnd:function(t){if(!this.disabled){var i=this.action,e=this.pointers;t.changedTouches?P(t.changedTouches,function(n){delete e[n.identifier]}):delete e[t.pointerId||0],i&&(t.preventDefault(),Object.keys(e).length||(this.action=""),this.cropping&&(this.cropping=!1,bt(this.dragBox,jt,this.cropped&&this.options.modal)),kt(this.element,re,{originalEvent:t,action:i}))}}},hr={change:function(t){var i=this.options,e=this.canvasData,n=this.containerData,a=this.cropBoxData,o=this.pointers,s=this.action,d=i.aspectRatio,h=a.left,l=a.top,c=a.width,u=a.height,w=h+c,f=l+u,k=0,x=0,b=n.width,R=n.height,C=!0,X;!d&&t.shiftKey&&(d=c&&u?c/u:1),this.limited&&(k=a.minLeft,x=a.minTop,b=k+Math.min(n.width,e.width,e.left+e.width),R=x+Math.min(n.height,e.height,e.top+e.height));var $=o[Object.keys(o)[0]],g={x:$.endX-$.startX,y:$.endY-$.startY},E=function(H){switch(H){case lt:w+g.x>b&&(g.x=b-w);break;case ct:h+g.x<k&&(g.x=k-h);break;case rt:l+g.y<x&&(g.y=x-l);break;case gt:f+g.y>R&&(g.y=R-f);break}};switch(s){case fe:h+=g.x,l+=g.y;break;case lt:if(g.x>=0&&(w>=b||d&&(l<=x||f>=R))){C=!1;break}E(lt),c+=g.x,c<0&&(s=ct,c=-c,h-=c),d&&(u=c/d,l+=(a.height-u)/2);break;case rt:if(g.y<=0&&(l<=x||d&&(h<=k||w>=b))){C=!1;break}E(rt),u-=g.y,l+=g.y,u<0&&(s=gt,u=-u,l-=u),d&&(c=u*d,h+=(a.width-c)/2);break;case ct:if(g.x<=0&&(h<=k||d&&(l<=x||f>=R))){C=!1;break}E(ct),c-=g.x,h+=g.x,c<0&&(s=lt,c=-c,h-=c),d&&(u=c/d,l+=(a.height-u)/2);break;case gt:if(g.y>=0&&(f>=R||d&&(h<=k||w>=b))){C=!1;break}E(gt),u+=g.y,u<0&&(s=rt,u=-u,l-=u),d&&(c=u*d,h+=(a.width-c)/2);break;case Et:if(d){if(g.y<=0&&(l<=x||w>=b)){C=!1;break}E(rt),u-=g.y,l+=g.y,c=u*d}else E(rt),E(lt),g.x>=0?w<b?c+=g.x:g.y<=0&&l<=x&&(C=!1):c+=g.x,g.y<=0?l>x&&(u-=g.y,l+=g.y):(u-=g.y,l+=g.y);c<0&&u<0?(s=It,u=-u,c=-c,l-=u,h-=c):c<0?(s=Rt,c=-c,h-=c):u<0&&(s=St,u=-u,l-=u);break;case Rt:if(d){if(g.y<=0&&(l<=x||h<=k)){C=!1;break}E(rt),u-=g.y,l+=g.y,c=u*d,h+=a.width-c}else E(rt),E(ct),g.x<=0?h>k?(c-=g.x,h+=g.x):g.y<=0&&l<=x&&(C=!1):(c-=g.x,h+=g.x),g.y<=0?l>x&&(u-=g.y,l+=g.y):(u-=g.y,l+=g.y);c<0&&u<0?(s=St,u=-u,c=-c,l-=u,h-=c):c<0?(s=Et,c=-c,h-=c):u<0&&(s=It,u=-u,l-=u);break;case It:if(d){if(g.x<=0&&(h<=k||f>=R)){C=!1;break}E(ct),c-=g.x,h+=g.x,u=c/d}else E(gt),E(ct),g.x<=0?h>k?(c-=g.x,h+=g.x):g.y>=0&&f>=R&&(C=!1):(c-=g.x,h+=g.x),g.y>=0?f<R&&(u+=g.y):u+=g.y;c<0&&u<0?(s=Et,u=-u,c=-c,l-=u,h-=c):c<0?(s=St,c=-c,h-=c):u<0&&(s=Rt,u=-u,l-=u);break;case St:if(d){if(g.x>=0&&(w>=b||f>=R)){C=!1;break}E(lt),c+=g.x,u=c/d}else E(gt),E(lt),g.x>=0?w<b?c+=g.x:g.y>=0&&f>=R&&(C=!1):c+=g.x,g.y>=0?f<R&&(u+=g.y):u+=g.y;c<0&&u<0?(s=Rt,u=-u,c=-c,l-=u,h-=c):c<0?(s=It,c=-c,h-=c):u<0&&(s=Et,u=-u,l-=u);break;case je:this.move(g.x,g.y),C=!1;break;case Ge:this.zoom(Qi(o),t),C=!1;break;case Xe:if(!g.x||!g.y){C=!1;break}X=ti(this.cropper),h=$.startX-X.left,l=$.startY-X.top,c=a.minWidth,u=a.minHeight,g.x>0?s=g.y>0?St:Et:g.x<0&&(h-=c,s=g.y>0?It:Rt),g.y<0&&(l-=u),this.cropped||(et(this.cropBox,W),this.cropped=!0,this.limited&&this.limitCropBox(!0,!0));break}C&&(a.width=c,a.height=u,a.left=h,a.top=l,this.action=s,this.renderCropBox()),P(o,function(N){N.startX=N.endX,N.startY=N.endY})}},ur={crop:function(){return this.ready&&!this.cropped&&!this.disabled&&(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&L(this.dragBox,jt),et(this.cropBox,W),this.setCropBoxData(this.initialCropBoxData)),this},reset:function(){return this.ready&&!this.disabled&&(this.imageData=_({},this.initialImageData),this.canvasData=_({},this.initialCanvasData),this.cropBoxData=_({},this.initialCropBoxData),this.renderCanvas(),this.cropped&&this.renderCropBox()),this},clear:function(){return this.cropped&&!this.disabled&&(_(this.cropBoxData,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),et(this.dragBox,jt),L(this.cropBox,W)),this},replace:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return!this.disabled&&t&&(this.isImg&&(this.element.src=t),i?(this.url=t,this.image.src=t,this.ready&&(this.viewBoxImage.src=t,P(this.previews,function(e){e.getElementsByTagName("img")[0].src=t}))):(this.isImg&&(this.replaced=!0),this.options.data=null,this.uncreate(),this.load(t))),this},enable:function(){return this.ready&&this.disabled&&(this.disabled=!1,et(this.cropper,De)),this},disable:function(){return this.ready&&!this.disabled&&(this.disabled=!0,L(this.cropper,De)),this},destroy:function(){var t=this.element;return t[I]?(t[I]=void 0,this.isImg&&this.replaced&&(t.src=this.originalUrl),this.uncreate(),this):this},move:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t,e=this.canvasData,n=e.left,a=e.top;return this.moveTo(Vt(t)?t:n+Number(t),Vt(i)?i:a+Number(i))},moveTo:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t,e=this.canvasData,n=!1;return t=Number(t),i=Number(i),this.ready&&!this.disabled&&this.options.movable&&(B(t)&&(e.left=t,n=!0),B(i)&&(e.top=i,n=!0),n&&this.renderCanvas(!0)),this},zoom:function(t,i){var e=this.canvasData;return t=Number(t),t<0?t=1/(1-t):t=1+t,this.zoomTo(e.width*t/e.naturalWidth,null,i)},zoomTo:function(t,i,e){var n=this.options,a=this.canvasData,o=a.width,s=a.height,d=a.naturalWidth,h=a.naturalHeight;if(t=Number(t),t>=0&&this.ready&&!this.disabled&&n.zoomable){var l=d*t,c=h*t;if(kt(this.element,oe,{ratio:t,oldRatio:o/d,originalEvent:e})===!1)return this;if(e){var u=this.pointers,w=ti(this.cropper),f=u&&Object.keys(u).length?Ki(u):{pageX:e.pageX,pageY:e.pageY};a.left-=(l-o)*((f.pageX-w.left-a.left)/o),a.top-=(c-s)*((f.pageY-w.top-a.top)/s)}else wt(i)&&B(i.x)&&B(i.y)?(a.left-=(l-o)*((i.x-a.left)/o),a.top-=(c-s)*((i.y-a.top)/s)):(a.left-=(l-o)/2,a.top-=(c-s)/2);a.width=l,a.height=c,this.renderCanvas(!0)}return this},rotate:function(t){return this.rotateTo((this.imageData.rotate||0)+Number(t))},rotateTo:function(t){return t=Number(t),B(t)&&this.ready&&!this.disabled&&this.options.rotatable&&(this.imageData.rotate=t%360,this.renderCanvas(!0,!0)),this},scaleX:function(t){var i=this.imageData.scaleY;return this.scale(t,B(i)?i:1)},scaleY:function(t){var i=this.imageData.scaleX;return this.scale(B(i)?i:1,t)},scale:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t,e=this.imageData,n=!1;return t=Number(t),i=Number(i),this.ready&&!this.disabled&&this.options.scalable&&(B(t)&&(e.scaleX=t,n=!0),B(i)&&(e.scaleY=i,n=!0),n&&this.renderCanvas(!0,!0)),this},getData:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,i=this.options,e=this.imageData,n=this.canvasData,a=this.cropBoxData,o;if(this.ready&&this.cropped){o={x:a.left-n.left,y:a.top-n.top,width:a.width,height:a.height};var s=e.width/e.naturalWidth;if(P(o,function(l,c){o[c]=l/s}),t){var d=Math.round(o.y+o.height),h=Math.round(o.x+o.width);o.x=Math.round(o.x),o.y=Math.round(o.y),o.width=h-o.x,o.height=d-o.y}}else o={x:0,y:0,width:0,height:0};return i.rotatable&&(o.rotate=e.rotate||0),i.scalable&&(o.scaleX=e.scaleX||1,o.scaleY=e.scaleY||1),o},setData:function(t){var i=this.options,e=this.imageData,n=this.canvasData,a={};if(this.ready&&!this.disabled&&wt(t)){var o=!1;i.rotatable&&B(t.rotate)&&t.rotate!==e.rotate&&(e.rotate=t.rotate,o=!0),i.scalable&&(B(t.scaleX)&&t.scaleX!==e.scaleX&&(e.scaleX=t.scaleX,o=!0),B(t.scaleY)&&t.scaleY!==e.scaleY&&(e.scaleY=t.scaleY,o=!0)),o&&this.renderCanvas(!0,!0);var s=e.width/e.naturalWidth;B(t.x)&&(a.left=t.x*s+n.left),B(t.y)&&(a.top=t.y*s+n.top),B(t.width)&&(a.width=t.width*s),B(t.height)&&(a.height=t.height*s),this.setCropBoxData(a)}return this},getContainerData:function(){return this.ready?_({},this.containerData):{}},getImageData:function(){return this.sized?_({},this.imageData):{}},getCanvasData:function(){var t=this.canvasData,i={};return this.ready&&P(["left","top","width","height","naturalWidth","naturalHeight"],function(e){i[e]=t[e]}),i},setCanvasData:function(t){var i=this.canvasData,e=i.aspectRatio;return this.ready&&!this.disabled&&wt(t)&&(B(t.left)&&(i.left=t.left),B(t.top)&&(i.top=t.top),B(t.width)?(i.width=t.width,i.height=t.width/e):B(t.height)&&(i.height=t.height,i.width=t.height*e),this.renderCanvas(!0)),this},getCropBoxData:function(){var t=this.cropBoxData,i;return this.ready&&this.cropped&&(i={left:t.left,top:t.top,width:t.width,height:t.height}),i||{}},setCropBoxData:function(t){var i=this.cropBoxData,e=this.options.aspectRatio,n,a;return this.ready&&this.cropped&&!this.disabled&&wt(t)&&(B(t.left)&&(i.left=t.left),B(t.top)&&(i.top=t.top),B(t.width)&&t.width!==i.width&&(n=!0,i.width=t.width),B(t.height)&&t.height!==i.height&&(a=!0,i.height=t.height),e&&(n?i.height=i.width/e:a&&(i.width=i.height*e)),this.renderCropBox()),this},getCroppedCanvas:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!this.ready||!window.HTMLCanvasElement)return null;var i=this.canvasData,e=Ji(this.image,this.imageData,i,t);if(!this.cropped)return e;var n=this.getData(t.rounded),a=n.x,o=n.y,s=n.width,d=n.height,h=e.width/Math.floor(i.naturalWidth);h!==1&&(a*=h,o*=h,s*=h,d*=h);var l=s/d,c=ot({aspectRatio:l,width:t.maxWidth||1/0,height:t.maxHeight||1/0}),u=ot({aspectRatio:l,width:t.minWidth||0,height:t.minHeight||0},"cover"),w=ot({aspectRatio:l,width:t.width||(h!==1?e.width:s),height:t.height||(h!==1?e.height:d)}),f=w.width,k=w.height;f=Math.min(c.width,Math.max(u.width,f)),k=Math.min(c.height,Math.max(u.height,k));var x=document.createElement("canvas"),b=x.getContext("2d");x.width=xt(f),x.height=xt(k),b.fillStyle=t.fillColor||"transparent",b.fillRect(0,0,f,k);var R=t.imageSmoothingEnabled,C=R===void 0?!0:R,X=t.imageSmoothingQuality;b.imageSmoothingEnabled=C,X&&(b.imageSmoothingQuality=X);var $=e.width,g=e.height,E=a,N=o,H,j,K,Z,F,U;E<=-s||E>$?(E=0,H=0,K=0,F=0):E<=0?(K=-E,E=0,H=Math.min($,s+E),F=H):E<=$&&(K=0,H=Math.min(s,$-E),F=H),H<=0||N<=-d||N>g?(N=0,j=0,Z=0,U=0):N<=0?(Z=-N,N=0,j=Math.min(g,d+N),U=j):N<=g&&(Z=0,j=Math.min(d,g-N),U=j);var z=[E,N,H,j];if(F>0&&U>0){var J=f/s;z.push(K*J,Z*J,F*J,U*J)}return b.drawImage.apply(b,[e].concat(We(z.map(function(st){return Math.floor(xt(st))})))),x},setAspectRatio:function(t){var i=this.options;return!this.disabled&&!Vt(t)&&(i.aspectRatio=Math.max(0,t)||NaN,this.ready&&(this.initCropBox(),this.cropped&&this.renderCropBox())),this},setDragMode:function(t){var i=this.options,e=this.dragBox,n=this.face;if(this.ready&&!this.disabled){var a=t===pe,o=i.movable&&t===Ve;t=a||o?t:Fe,i.dragMode=t,zt(e,Lt,t),bt(e,te,a),bt(e,ee,o),i.cropBoxMovable||(zt(n,Lt,t),bt(n,te,a),bt(n,ee,o))}return this}},dr=it.Cropper,ii=function(){function r(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(Di(this,r),!t||!$i.test(t.tagName))throw new Error("The first argument is required and must be an <img> or <canvas> element.");this.element=t,this.options=_({},Oe,wt(i)&&i),this.cropped=!1,this.disabled=!1,this.pointers={},this.ready=!1,this.reloading=!1,this.replaced=!1,this.sized=!1,this.sizing=!1,this.init()}return Ti(r,[{key:"init",value:function(){var i=this.element,e=i.tagName.toLowerCase(),n;if(!i[I]){if(i[I]=this,e==="img"){if(this.isImg=!0,n=i.getAttribute("src")||"",this.originalUrl=n,!n)return;n=i.src}else e==="canvas"&&window.HTMLCanvasElement&&(n=i.toDataURL());this.load(n)}}},{key:"load",value:function(i){var e=this;if(i){this.url=i,this.imageData={};var n=this.element,a=this.options;if(!a.rotatable&&!a.scalable&&(a.checkOrientation=!1),!a.checkOrientation||!window.ArrayBuffer){this.clone();return}if(Li.test(i)){zi.test(i)?this.read(ir(i)):this.clone();return}var o=new XMLHttpRequest,s=this.clone.bind(this);this.reloading=!0,this.xhr=o,o.onabort=s,o.onerror=s,o.ontimeout=s,o.onprogress=function(){o.getResponseHeader("content-type")!==Ne&&o.abort()},o.onload=function(){e.read(o.response)},o.onloadend=function(){e.reloading=!1,e.xhr=null},a.checkCrossOrigin&&Pe(i)&&n.crossOrigin&&(i=Le(i)),o.open("GET",i,!0),o.responseType="arraybuffer",o.withCredentials=n.crossOrigin==="use-credentials",o.send()}}},{key:"read",value:function(i){var e=this.options,n=this.imageData,a=ar(i),o=0,s=1,d=1;if(a>1){this.url=rr(i,Ne);var h=nr(a);o=h.rotate,s=h.scaleX,d=h.scaleY}e.rotatable&&(n.rotate=o),e.scalable&&(n.scaleX=s,n.scaleY=d),this.clone()}},{key:"clone",value:function(){var i=this.element,e=this.url,n=i.crossOrigin,a=e;this.options.checkCrossOrigin&&Pe(e)&&(n||(n="anonymous"),a=Le(e)),this.crossOrigin=n,this.crossOriginUrl=a;var o=document.createElement("img");n&&(o.crossOrigin=n),o.src=a||e,o.alt=i.alt||"The image to crop",this.image=o,o.onload=this.start.bind(this),o.onerror=this.stop.bind(this),L(o,Te),i.parentNode.insertBefore(o,i.nextSibling)}},{key:"start",value:function(){var i=this,e=this.image;e.onload=null,e.onerror=null,this.sizing=!0;var n=it.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(it.navigator.userAgent),a=function(h,l){_(i.imageData,{naturalWidth:h,naturalHeight:l,aspectRatio:h/l}),i.initialImageData=_({},i.imageData),i.sizing=!1,i.sized=!0,i.build()};if(e.naturalWidth&&!n){a(e.naturalWidth,e.naturalHeight);return}var o=document.createElement("img"),s=document.body||document.documentElement;this.sizingImage=o,o.onload=function(){a(o.width,o.height),n||s.removeChild(o)},o.src=e.src,n||(o.style.cssText="left:0;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;opacity:0;position:absolute;top:0;z-index:-1;",s.appendChild(o))}},{key:"stop",value:function(){var i=this.image;i.onload=null,i.onerror=null,i.parentNode.removeChild(i),this.image=null}},{key:"build",value:function(){if(!(!this.sized||this.ready)){var i=this.element,e=this.options,n=this.image,a=i.parentNode,o=document.createElement("div");o.innerHTML=Hi;var s=o.querySelector(".".concat(I,"-container")),d=s.querySelector(".".concat(I,"-canvas")),h=s.querySelector(".".concat(I,"-drag-box")),l=s.querySelector(".".concat(I,"-crop-box")),c=l.querySelector(".".concat(I,"-face"));this.container=a,this.cropper=s,this.canvas=d,this.dragBox=h,this.cropBox=l,this.viewBox=s.querySelector(".".concat(I,"-view-box")),this.face=c,d.appendChild(n),L(i,W),a.insertBefore(s,i.nextSibling),et(n,Te),this.initPreview(),this.bind(),e.initialAspectRatio=Math.max(0,e.initialAspectRatio)||NaN,e.aspectRatio=Math.max(0,e.aspectRatio)||NaN,e.viewMode=Math.max(0,Math.min(3,Math.round(e.viewMode)))||0,L(l,W),e.guides||L(l.getElementsByClassName("".concat(I,"-dashed")),W),e.center||L(l.getElementsByClassName("".concat(I,"-center")),W),e.background&&L(s,"".concat(I,"-bg")),e.highlight||L(c,_i),e.cropBoxMovable&&(L(c,ee),zt(c,Lt,fe)),e.cropBoxResizable||(L(l.getElementsByClassName("".concat(I,"-line")),W),L(l.getElementsByClassName("".concat(I,"-point")),W)),this.render(),this.ready=!0,this.setDragMode(e.dragMode),e.autoCrop&&this.crop(),this.setData(e.data),Y(e.ready)&&V(i,Se,e.ready,{once:!0}),kt(i,Se)}}},{key:"unbuild",value:function(){if(this.ready){this.ready=!1,this.unbind(),this.resetPreview();var i=this.cropper.parentNode;i&&i.removeChild(this.cropper),et(this.element,W)}}},{key:"uncreate",value:function(){this.ready?(this.unbuild(),this.ready=!1,this.cropped=!1):this.sizing?(this.sizingImage.onload=null,this.sizing=!1,this.sized=!1):this.reloading?(this.xhr.onabort=null,this.xhr.abort()):this.image&&this.stop()}}],[{key:"noConflict",value:function(){return window.Cropper=dr,r}},{key:"setDefaults",value:function(i){_(Oe,wt(i)&&i)}}]),r}();_(ii.prototype,or,sr,lr,cr,hr,ur);const ri={data:{cropper:null},view:function(r){var t,i;return t=this,m("",[m("",{style:{display:"block",width:"15rem",height:"15rem"}},[m("img#avatar_upload",{src:(i=y.user)!=null&&i.avatar?`${transUrl(y.user.avatar)}`:"./statics/default_avatar.jpg",style:{maxWidth:"100%"}})]),m(v,{tagName:"input[type=file]",accept:"image/jpg,image/jpeg,image/png,image/PNG,image/gif,image/GIF",ext:{onchange:function(e){var n,a;return n=e.target.files[0],n.size/1024>2e3?S.launch({msg:"文件尺寸不能大于2M哦"}):(a=new FileReader,a.onload=function(o){var s;return s=document.querySelectorAll("#avatar_upload")[0],s.src=o.target.result,t.data.cropper=new ii(s,{aspectRatio:1,viewMode:2,preview:"",dragMode:"move"})},a.readAsDataURL(n))}}}),m(v,{isBtn:!0,onclick:function(){return t.data.cropper?t.data.cropper.getCroppedCanvas().toBlob(async function(e){var n,a;return n=new FormData,n.append("avatar",e),a=await m.request({withCredentials:!0,url:`${apiHost}/api/avatar/set`,method:"post",body:n}),a.valid?(await y.fresh(),S.launch({msg:"上传成功，图像更新可能有延迟，请ctrl+shift+r强制刷新页面。app端请重启app。"})):alert(a.msg)}):S.launch({msg:"请选择文件哈"})}},"点这里提交哦")])}};var le;le=function(){return{data:{emailAddress:v(),emailCode:v(),userPassword:v(),emailTime:0,emailTimer:null,unBindComp:function(){var r;return r=le(),{view:function(t){return m("",[m(r,{isBind:!1,sendClick:async()=>await y.unbindEmail(),verifyClick:async()=>{if(await y.unbindEmail(r.data.emailCode.data.value)==="解绑成功")return t.attrs.delete()}})])}}}},oninit:function(){var r,t;if((r=y.user)!=null&&r.email)return this.data.emailAddress.data.value=(t=y.user)!=null?t.email:void 0},view:function(r){var t,i,e;return r.attrs,m("",[r.attrs.isBind?((t=y.user)!=null?t.emailVerify:void 0)===1?m(v,`您已经绑定邮箱，${(i=y.user)!=null?i.email:void 0}，可解绑后重新绑定。`):m(v,"您尚未绑定邮箱哦，为了安全起见，请尽快绑定。"):r.attrs.tip?m(v,r.attrs.tip):void 0,m("",{style:{display:"grid",gridTemplateColumns:"1fr 2fr"}},[m(v,"邮箱地址"),m(this.data.emailAddress,{tagName:"input[type=text]",style:{border:/^(\w+@(vip\.){0,1}qq\.com)|(\w+@foxmail\.com)$/.test(this.data.emailAddress.data.value)?`1px solid ${A("green").back}`:`1px solid ${A("red").back}`},ext:{disabled:y.user!=null&&r.attrs.isBind===!1,autocomplete:"on"}}),m(v,"验证码"),m(this.data.emailCode,{tagName:"input[type=text]"}),m("",""),m("",[m(v,{isBtn:!(this.data.emailTime>0),color:this.data.emailTime>0?"grey":"dark",ext:{disabled:this.data.emailTime>0},onclick:r.attrs.sendClick},`发送验证码${this.data.emailTime>0?`(${this.data.emailTime})`:""}`),m(v,{isBtn:!0,color:"red",onclick:r.attrs.verifyClick},r.attrs.isBind?"绑定":"验证"),r.attrs.isBind&&((e=y.user)!=null?e.emailVerify:void 0)===1?m(v,{isBtn:!0,color:"yellow",onclick:()=>S.launch({msg:"需要验证原邮箱，在弹窗中向原邮箱发送验证码，要继续吗？",confirm:()=>{S.launch({content:this.data.unBindComp,hideBtn:!0,tip:"验证原邮箱"})}})},"解绑"):void 0])])])}}};const ve=le;var Ut,Xt,_t,ai;_t=ve();ai={view:function(r){return m("",[m(_t,{sendClick:async()=>{var t,i;try{return i=await m.request({withCredentials:!0,url:`${apiHost}/api/auth/email/login`,method:"post",body:{email:_t.data.emailAddress.data.value}}),S.launch({msg:i.msg})}catch(e){return t=e,console.dir(t)}},verifyClick:async()=>{var t,i;try{if(i=await m.request({withCredentials:!0,url:`${apiHost}/api/auth/email/login`,method:"post",body:{email:_t.data.emailAddress.data.value,code:_t.data.emailCode.data.value}}),S.launch({msg:i.msg}),i.user)return await y.fresh(),hi("loginSucessCommon"),r.attrs.delete(),m.redraw()}catch(e){return t=e,console.dir(t)}}})])}};Xt=new v;Ut=new v;const mr={view:function({attrs:r}){var t,i,e;return m("",{style:{width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",backgroundSize:"100% auto",backgroundRepeat:"no-repeat",backgroundPosition:"bottom"}},[m("form.animated.zoomIn",{style:{display:"inline-block",display:"flex",flexDirection:"column",alignItems:"center"}},[m("img",{src:`${(t=(i=D.options)!=null?i.get("global_styleLogoLight"):void 0)?t:((e=D.options)!=null?e.get("global_theme"):void 0)===2?"./statics/logo3.png":"./statics/logo.png"}`,style:{width:"10rem",marginBottom:"5rem",marginTop:"5rem"}}),m(Xt,{tagName:"input[type=text][placeholder=用户名]",style:{width:"20rem",height:"3rem",borderRadius:"100px",opacity:"0.8"}}),m(Ut,{tagName:"input[type=password][placeholder=密码]",style:{width:"20rem",height:"3rem",borderRadius:"100px",opacity:"0.8"},ext:{onkeypress:async n=>{if(n.keyCode===13)return await y.enter(Xt.data.value,Ut.data.value)}}}),m("img[src=statics/login_arrow.svg]",{style:{marginTop:"5rem",width:"5rem",cursor:"pointer",transition:"opacity 1s ease"},onmouseover:n=>n.target.style.opacity="0.8",onmouseout:n=>n.target.style.opacity="1",onclick:async()=>await y.enter(Xt.data.value,Ut.data.value)}),m("",{style:{marginTop:"2rem",height:"10rem",width:"30rem",display:"flex",alignItems:"center",justifyContent:"space-around"}},[m(T,{isBtn:!0,onclick:()=>S.launch({tip:"邮箱登录",content:ai,hideBtn:1})},"邮箱登录"),m(T,{isBtn:!0,onclick:()=>S.launch({tip:"旧Discuz账户登录",content:Mi,hideBtn:1})},"旧版登录"),m(T,{isBtn:!0,onclick:()=>S.launch({msg:"首次登录就是注册哦"})},"如何加入"),m(T,{isBtn:!0,onclick:()=>S.launch({tip:"反馈",content:function(){return{view:function(){var n;return m(v,{style:{display:"block"}},[m.trust(((n=D.options)!=null?n.get("join_feedbackUrl"):void 0)||"暂无信息")])}}}})},"反馈")])])])}};function fr(){var r,t;return t=[],r=!1,{oninit:async function({attrs:i}){var e;if(e=i.oneSay,t=await Q.get("likeSays"),t!=null&&typeof t.find=="function"&&t.find(n=>n.say===e.say))return r=!0},view:function({attrs:i}){var e,n;return e=i.oneSay,m(T,{tagName:"i.ri-heart-add-fill",styleExt:{color:r?A("red").back:(n=D.options)!=null&&n.get("global_styleBlackMode")?A("lightGray").back:A("dark").back,fontSize:"1.6rem"},onclick:async()=>(await Q.get("likeSays")||await Q.set("likeSays",[]),t=await Q.get("likeSays"),t.find(a=>a.say===e.say)?(t=t.filter(a=>a.say!==e.say),r=!1):(t.push(e),r=!0),await Q.set("likeSays",t))})}}}function pr(r,t){return new RegExp(`{{{${r}}}}`,"g").test(t)}function gr(){var r;return r=null,{oninit:async function({attrs:t}){var i,e,n,a,o;if(r=t.goods,o=t.self,r){for(a=[],e=0,n=r.length;e<n;e++)i=r[e],a.push(await(s=>{var d,h,l,c;try{return h=(l=o.icat_users_extend)!=null&&(c=l.icat_vars)!=null?c.find(u=>u.key===`good${s.goodid}_switch`):void 0,s.switch=h!=null?h.value:void 0}catch(u){return d=u,console.log(d)}})(i));return a}},view:function({attrs:t}){var i;if(r!=null&&r.find(e=>e.switch))return m("",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(2rem,1fr))",borderRadius:"2rem",overflow:"hidden",margin:M.readMode===1?"1rem 0":"1rem 2rem",padding:"0.5rem",gap:"0.5rem",border:(i=D.options)!=null&&i.get("global_styleBlackMode")?M.readMode===1?"0.1rem dashed #555":void 0:M.readMode===1?"0.1rem dashed #ccc":void 0}},[r.map(e=>{if(e.switch)return m("img",{src:transUrl(e.icon),style:{placeSelf:"center",width:"2rem",height:"2rem",cursor:"pointer"},onclick:()=>Notice.launch({tip:e.name,content:function(){return{view:function(){return m("",{style:{margin:"1rem"}},[m.trust(e.description)])}}}})})})])}}}function vr(){return{view:function(){var r,t;return m("",{style:{display:"flex",justifyContent:"center",flexDirection:"column",alignItems:"center",background:(r=D.options)!=null&&r.get("global_styleBlackMode")?"rgba(0,0,0,0.8)":"rgba(250,250,250,0.3)",backdropFilter:"blur(10px)","-webkit-backdrop-filter":"blur(10px)",width:"100%",height:"30rem",borderRadius:"1rem"}},[m("",{style:{fontSize:"2rem",color:(t=D.options)!=null&&t.get("global_styleBlackMode")?"#eee":"#888"}},"( ๑ŏ ﹏ ŏ๑ )"),m("",{style:{marginTop:"1rem",fontSize:"1.5rem",color:"#888"}},"...努力加载中...")])}}}function yr(){return{view:function({attrs:r}){var t,i,e,n,a,o,s,d,h,l,c,u,w,f,k,x;return f=r.self,n=r.parent,e=r.blockInfo,w=r.routeMatch,i=r._this,t=r.Thread,k=r.showName,x=r.v,m("",{style:{margin:"1rem 0"}},[m("",{style:{display:"flex",alignItems:"center"}},[m("",{isBtn:!0,style:{margin:0,borderRadius:"3rem",display:"flex",justifyContent:"center",flexDirection:"column"}},[m(v,{isBtn:!0,onclick:function(){return ROUTE.set(`/home/${f.pid}`)},class:"animated",style:{width:"15rem",height:"10rem",borderRadius:"2rem",backgroundImage:`url(${transUrl(e.icon)})`,backgroundColor:(a=D.options)!=null&&a.get("global_styleBlackMode")?"rgba(0,0,0,0.8)":"rgba(215,215,215,0.3)",border:(o=D.options)!=null&&o.get("global_styleBlackMode")?"0.2rem solid #333":void 0,outline:(s=D.options)!=null&&s.get("global_styleBlackMode")?"0.4rem solid #000":void 0,backgroundSize:"cover",marginBottom:"1rem",position:"relative",boxShadow:"0 0 1rem rgba(0,0,0,0.3)",display:"flex",flexDirection:"column"}},[f.linkid&&`/home/${f.linkid}`!==w?m(T,{isBtn:!0,ext:{onclick:b=>(ROUTE.set(`/home/${f.linkid}`),b.stopPropagation())},onmouseover:(b,R)=>{},onmouseout:(b,R)=>{}},"↑返回上级"):void 0,m("",{style:{marginTop:"auto",width:"100%",textAlign:"center"}},[m(T,JSON.parse(f.content).name),m(T,{isBlock:!0,color:"none",styleExt:{position:"absolute",right:0,bottom:0},ext:{onclick:b=>(f.showBlockMenu=!f.showBlockMenu,b.stopPropagation()),onmouseover:b=>(b.target.style.opacity=.8,b.stopPropagation()),onmouseout:b=>(b.target.style.opacity=1,b.stopPropagation())}},f.showBlockMenu?m("i",[m.trust(iconPark.getIcon("MoreOne",{fill:["#fff","#fff","#fff","#fff"]}))]):m("i",[m.trust(iconPark.getIcon("MoreOne",{fill:["#fff","#fff","#fff","#fff"]}))]))])]),f.showBlockMenu?m(v,{color:"none",class:"animated fadeInDown",style:{padding:"1rem 1rem",margin:"0 1rem",borderRadius:"1rem",display:"flex",zIndex:1}},[m(ze,{self:f,parent:n,freshType:"thread"}),f.replyCalc>0?m(T,{color:f.showReply?"sliver":"none",isBtn:!0,onclick:function(){return i.method.showReply(x)},styleExt:{display:"inline-flex",flexDirection:"column",justifyContent:"center"}},[m("i",{style:{color:f.showReply?void 0:"#43599A",verticalAlign:"top"}},[m.trust(iconPark.getIcon("Comments",{theme:"outline",fill:"#666"})),m("span",{style:{color:"#666",fontSize:"1rem"}},f.replyCalc)]),k?m("span",{style:{verticalAlign:"top",fontSize:"1rem"}},`帖子(${f.replyCalc})`):void 0]):void 0]):void 0])]),f.showReply===!0?[m("",{style:{marginLeft:"1rem",display:"flex",flexWrap:"wrap"},oncreate:({dom:b})=>i.data.scrollToDom=b},[(d=M.posts[f.pid])!=null?d.getPage().map((b,R)=>m(t,{key:b.pid,self:b,parent:f,index:R})):void 0]),((h=M.posts[f.pid])!=null?h.length:void 0)>0?m("",{style:{display:"none",justifyContent:"center",alignItems:"center"}},[m("",{style:{margin:"1rem 0 0 0",background:"#504F50",width:"20%",height:"0.8rem",borderRadius:"3rem"}})]):void 0,(l=M.posts[f.pid])!=null&&l.data[0]&&f.showReply?(((c=M.posts[f.pid])!=null?c.data.length:void 0)===0&&m(vr),[m(Mt,{rows:M.posts[f.pid],type:"thread",scrollToDom:i.data.scrollToDom}),m(v,{isBlock:!0,isBtn:!0,style:{boxShadow:"0 0 1rem rgba(3,3,3,0.05)",color:"#888",borderRadius:"2rem",background:"rgba(215,215,215,0.3)",background:(u=D.options)!=null&&u.get("global_styleBlackMode")?"rgba(0,0,0,0.5)":"rgba(215,215,215,0.3)",backdropFilter:"blur(10px)","-webkit-backdrop-filter":"blur(10px)"},onclick:function(){return document.querySelector("#home").scrollTo({top:0}),i.method.showReply(x)}},`${f.showReply?"( ๑ŏ ﹏ ŏ๑ )":"|･ω･｀)"}`)]):void 0]:void 0])}}}function wr(){var r;return r="/home",{oninit:function(){var t;return r=(t=m.route.get().match(/\/home\/\d+/g))!=null?t[0]:void 0},view:function({attrs:t}){var i,e,n,a,o,s,d,h,l,c,u,w,f;return f=t.self,m(v,{style:{display:"flex",alignItems:"center",padding:"0"}},[m($e,{oncreate:function({dom:k}){},source:"thread",sourceSelf:f,style:{width:"3rem",paddingBottom:"3rem"},src:f.contentType==="spiderRss"&&f.uid===1?"/statics/logo_avatar.svg":(i=(e=f.icat_users_extend)!=null?e.avatar:void 0)!=null?i:"/statics/default_avatar.jpg"}),m(v,{isBlock:!0,style:{flex:1,marginBottom:0,borderRight:f.isTop>0?"solid 0.4rem #FFBB33":f.author===((o=y.user)!=null?o.user:void 0)?(s=D.options)!=null&&s.get("global_styleBlackMode")?"solid 0.4rem #000":"solid 0.4rem #65C4AD":(d=D.options)!=null&&d.get("global_styleBlackMode")?"solid 0.4rem #000":"solid 0.4rem #65C4AD",borderRadius:"0 0.5rem 0.5rem 0",display:"flex",alignItems:"center",margin:"0",padding:"0.5rem",background:(h=D.options)!=null&&h.get("global_styleBlackMode")?t.index&&t.index%2===0?"#3A64E4":A("yellow").back:A("brown").back,background:"unset"}},[m(`a[href=#!/home/${f.pid}]`,{style:{textOverflow:"ellipsis",overflow:"hidden",wordBreak:"break-all",whiteSpace:"nowrap",color:(l=D.options)!=null&&l.get("global_styleBlackMode")?"#ddd":"#333",fontWeight:"bolder",margin:"0.5rem 0"},onclick:k=>(k.preventDefault(),ROUTE.set(`/home/${f.pid}`))},[f.isTop>0?m(T,{styleExt:{borderRadius:"0.5rem",margin:"0rem 0.5rem 0rem 0"},color:"red"},"顶"):void 0,f.isGood>0?m(T,{color:"yellow",styleExt:{borderRadius:"0.5rem",margin:"0rem 0.5rem 0rem 0"}},"精"):void 0,f.isLock>0?m(T,{styleExt:{borderRadius:"0.5rem",margin:"0rem 0.5rem 0rem 0"}},"锁"):void 0,f.isHide>0?m(T,{styleExt:{borderRadius:"0.5rem",margin:"0rem 0.5rem 0rem 0"}},"隐"):void 0,f.isHide>0?"该帖子已封存，无法查看":Mob?yt(f.title.slice(0,16)).replace(/<[^<>]+>/g,""):yt(f.title.slice(0,61)).replace(/<[^<>]+>/g,""),m(T,{onclick:()=>(S.launch({content:()=>({view:function(){return m("",[m(v,{isBtn:!0,tagName:`a[href=${`#!/home/${f.pid}`}]`},"打开帖子"),m(v,{isBtn:!0,onclick:async()=>{var k;return k=location.origin+`/null-${f.pid}-null.html`,await navigator.clipboard.writeText(k),S.launch({msg:"链接已复制"})}},"复制链接")])}})}),!1)},[m.trust(iconPark.getIcon("LinkTwo",{size:"1.2rem",fill:(c=D.options)!=null&&c.get("global_styleBlackMode")?["#eee","#eee","#eee","#eee"]:["#333","#333","#333","#333"]}))])]),m(T,{isBtn:!0,color:"none",styleExt:{margin:"0 0.1rem 0 auto"},onclick:()=>ROUTE.set(`/home/${f.linkid}`)},[f.linkid!==0&&`/home/${f.pid}`===r?m.trust(iconPark.getIcon("UpSmall",{fill:(u=D.options)!=null&&u.get("global_styleBlackMode")?["#fff","#fff","#fff","#fff"]:["#333","#333","#333","#333"]})):void 0]),f.uid===((w=y.user)!=null?w.uid:void 0)||((n=y.user)!=null?n.power:void 0)>=80?m(T,{isBtn:!0,color:"none",styleExt:{marginRight:0,position:"relative"},ext:{onclick:function(k){var x;return f.showMoreMenu=!f.showMoreMenu,f.showMoreMenu&&document.addEventListener("click",x=function(b){return f.showMoreMenu=!1,m.redraw(),document.removeEventListener("click",x)}),k.stopPropagation()}}},[m("i",[m.trust(iconPark.getIcon("MoreOne",{fill:(a=D.options)!=null&&a.get("global_styleBlackMode")?["#fff","#fff","#fff","#fff"]:["#333","#333","#333","#333"]}))]),f.showMoreMenu?m(He,{self:f}):void 0]):void 0])])}}}function ni(){return{view:function({attrs:r}){return m("span",{style:{display:"inline-flex",alignItems:"center",...r.style}},[function(){switch(r.user.sex){case 1:return m.trust(iconPark.getIcon("Male",{fill:"#4a90e2",theme:"outline",size:"12px"}));case 2:return m.trust(iconPark.getIcon("Female",{fill:"#f18284",theme:"outline",size:"12px"}));case 3:return[m.trust(iconPark.getIcon("Male",{fill:"#4a90e2",theme:"outline",size:"12px"})),m.trust(iconPark.getIcon("DoubleRight",{fill:"#bbb",theme:"outline",size:"12px"})),m.trust(iconPark.getIcon("Female",{fill:"#f18284",theme:"outline",size:"12px"}))];case 4:return[m.trust(iconPark.getIcon("Female",{fill:"#f18284",theme:"outline",size:"12px"})),m.trust(iconPark.getIcon("DoubleRight",{fill:"#bbb",theme:"outline",size:"12px"})),m.trust(iconPark.getIcon("Male",{fill:"#4a90e2",theme:"outline",size:"12px"}))];default:return m.trust(iconPark.getIcon("Male",{fill:"#4a90e2",theme:"outline",size:"12px"}))}}()])}}}function oi(){return{view:function(){return m("","组件异常")}}}function br(){var r,t;return r="",t=null,{oncreate:function(){if(t)return clearInterval(t)},view:function(){return m("",{style:{width:"100%",height:"50rem",background:"#C6DAF6",display:"flex",justifyContent:"center",alignItems:"center"}},[m("",{style:{width:"100%",height:"25rem",backgroundImage:`url(/statics/icat${r}.svg)`,backgroundRepeat:"no-repeat",animation:"icat 2s"}})])}}}var vt;vt=(r,t)=>Math.floor(r+Math.random()*(t-r));const G={ball:{x:15,y:15,r:15,dx:8,dy:8,reset:function(r){return this.x=15,this.y=15,this.dx=8,this.dy=8,this.draw(r)},draw:function(r){return r.beginPath(),r.fillStyle="#ffcd42",r.arc(this.x,this.y,this.r,0,Math.PI*2),r.fill()},checkIntersect:function(r,t){return(this.x-r)**2+(this.y-t)**2<this.r**2},checkWall:function(r,t){if((this.x+this.dx<=this.r||this.x+this.dx>=t.width-this.r)&&(this.dx=-this.dx),this.y+this.dy<=this.r)return this.dy=-this.dy;if(this.y+this.dy>=t.height-this.r)return console.log("呜呜，失败了哇┭┮﹏┭┮"),r.gameOver=!0},move:function(){return this.x+=this.dx,this.y+=this.dy}},Rect:class{constructor(r,t,i,e,n){this.x=r,this.y=t,this.w=i,this.h=e,this.c=n,this.show=!0}draw(r){if(this.show)return r.beginPath(),r.fillStyle=this.c,r.fillRect(this.x,this.y,this.w,this.h)}},RectGroup:class{constructor(r,t,i,e,n,a){var o,s,d,h;for(this.m=r,this.n=t,this.d=i,this.h=e,this.Rect=n,this.canvas=a,o=()=>{var l,c;return l=()=>vt(100,250),c="",[0,1,2].forEach(u=>c+=l().toString(16)),"#"+c},this.rectGroup=[],s=d=0,h=this.n;0<=h?d<h:d>h;s=0<=h?++d:--d)(l=>{var c,u,w,f;for(this.defaultY=this.d+this.d/2*l+this.h*l,f=[],c=u=0,w=this.m;0<=w?u<w:u>w;c=0<=w?++u:--u)f.push((k=>(this.defaultX=this.d*(k+1)+(this.canvas.width-(this.m+1)*this.d)/this.m*k,this.rectGroup.push(new this.Rect(this.defaultX,this.defaultY,(this.canvas.width-(this.m+1)*this.d)/this.m,this.h,o()))))(c));return f})(s)}draw(r,t,i){return this.rectGroup.forEach((e,n)=>{var a,o,s,d,h,l;for(this.x1=e.x,this.x2=e.x+e.w,this.y1=e.y,this.y2=e.y+e.h,a=s=0,h=this.x2-this.x1;0<=h?s<h:s>h;a=0<=h?++s:--s)for(o=d=0,l=this.y2-this.y1;0<=l?d<l:d>l;o=0<=l?++d:--d)if(t.checkIntersect(this.x1+a,this.y1+o)){e.show=!1,e.x=-500,e.y=-500,e.w=0,e.h=0,t.dy=-t.dy,i.num+=1,i.sum+=1;return}return e.draw(r)})}},level:{data:[],createData:function(){return this.data=(function(){for(var r=[],t=1;t<=100;t++)r.push(t);return r}).apply(this).map(r=>[vt(3,8),vt(3,8),vt(20,80),vt(20,30)])},group:[],createGroup:function(r,t,i){return this.group=this.data.map(e=>new r(e[0],e[1],e[2],e[3],t,i))},num:0,draw:function(r,t,i,e){return this.group.forEach((n,a)=>{if(this.num===a)return n.draw(r,t,i);if(this.num>=this.group.length)return console.log("恭喜(●'◡'●)过关"),e.passGame=!0})},checkPassLevel:function(r){if(r.num>=this.data[this.num][0]*this.data[this.num][1])return this.num+=1,r.num=0},reset:function(r,t,i,e,n,a,o){return this.num=0,this.createData(),this.createGroup(r,t,i),this.draw(e,n,a,o),o.passGame=!1}},score:{msg:"",num:0,sum:0,reset:function(){return this.msg="",this.num=0,this.sum=0},draw:function(r,t,i){return this.msg=`Level:${t.num+1} Score:${this.sum}`,r.beginPath(),r.font="30px Arial",r.fillStyle="#7b2c34",r.fillText(this.msg,i.width-250-this.msg.length,500)}},racket:{rect:null,d:20,l:!1,r:!1,createRect:function(r,t){return this.rect=new r((t.width-150)/2,t.height-20,150,20,"#6d93fe")},reset:function(r,t){return this.createRect(r,t)},draw:function(r,t,i){var e,n,a,o;return[e,n,a,o]=[this.rect.x,this.rect.x+this.rect.w,this.rect.y,this.rect.y+this.rect.h],(()=>{var s,d,h,l,c,u;for(s=h=0,c=n-e;0<=c?h<c:h>c;s=0<=c?++h:--h)for(d=l=0,u=o-a;0<=u?l<u:l>u;d=0<=u?++l:--l)if(t.checkIntersect(e+s,a+d)){t.dy=-t.dy,t.y+=t.dy;return}})(),this.r&&!this.l&&this.rect.x<i.width-this.rect.w&&(this.rect.x+=this.d,console.log(1)),this.l&&!this.r&&this.rect.x>0&&(this.rect.x+=-this.d,console.log(2)),this.rect.draw(r)}}};function xr(){var r,t,i,e,n,a,o,s;return r={start:!1,initGame:null,passGame:!1,gameOver:!1},s=!1,i=e=a=o=null,n=[],t=({dom:d})=>{var h,l,c,u,w,f,k,x,b,R;return u=d,f=u.getContext("2d"),w=()=>f.clearRect(0,0,u.width,u.height),c=G.ball,R=G.score,h=G.Rect,l=G.RectGroup,x=G.level,x.createData(),x.createGroup(l,h,u),b=G.racket,b.createRect(h,u),i=function(){return b.l=!0,b.r=!1},e=function(){return b.l=!1},a=function(){return b.r=!0,b.l=!1},o=function(){return b.r=!1},addEventListener("keydown",C=>{if(C.keyCode===39&&a(),C.keyCode===37)return i()}),addEventListener("keyup",C=>{if(C.keyCode===39&&o(),C.keyCode===37)return e()}),k=()=>(w(),x.checkPassLevel(R),c.checkWall(r,u),b.draw(f,c,u),x.draw(f,c,R,r),c.move(),c.draw(f),R.draw(f,x,u)),setInterval(()=>{var C;if(r.start){if(r.passGame){C="恭喜通关~",f.beginPath(),f.font="30px Arial",f.fillStyle="#7b2c34",f.fillText(C,u.width-250-C.length,40);return}if(r.gameOver){C="呜呜，失败了",f.beginPath(),f.font="30px Arial",f.fillStyle="#7b2c34",f.fillText(C,u.width-250-C.length,40);return}return k()}},40),k(),r.initGame=function(){return r.start=!1,r.gameOver=!1,r.passGame=!1,w(),c.reset(f),x.reset(l,h,u,f,c,R,r),b.reset(h,u),R.reset()}},{oninit:async function(){if(n=await Q.get("racketInfo"),Object.prototype.toString.call(n)!=="[object Array]")return n=[]},view:function({attrs:d}){return m("",[(n!=null?n[0]:void 0)!=null&&s?m("",[m("table.article",[m("tr","历史成绩"),n.map(h=>[m("tr",[m("td","时间"),m("td",dt(h.timestamp).format("MMMM Do YYYY, h:mm:ss a"))]),m("tr",[m("td","等级"),m("td",h.level)]),m("tr",[m("td","得分"),m("td",h.score)])])])]):void 0,m(v,{isBtn:!0,color:"red",onclick:()=>r.start=!r.start},r.start?"暂停":"开始"),m(v,{isBtn:!0,color:"red",onclick:()=>r.initGame()},"重置"),d.isIndex?void 0:(m(v,{isBtn:!0,color:"yellow",onclick:async()=>{var h,l;if(y.isLogined()){if(G.score.sum<5){S.launch({msg:"得分还不够哦"});return}try{return n.length>=10&&n.splice(0,1),n.push({timestamp:Date.now(),score:G.score.sum,level:G.level.num,metadata:{ball:G.ball,score:G.score,racket:G.racket}}),l=await Q.set("racketInfo",n),l==null?S.launch({msg:"提交异常"}):S.launch({msg:"提交成功"})}catch(c){return h=c,console.dir(h),S.launch({msg:"提交异常 - 2"})}}}},"提交分数（仅保留10次）"),m(v,{isBtn:!0,color:"brown",onclick:()=>s=!s},s?"收起成绩":"显示成绩"),m(v,{isBtn:!0,color:"brown",onclick:()=>S.launch({msg:"功能完善中，可以手动复制然后发帖"})},"分享")),m("canvas",{style:{width:"98%",border:"0.1rem solid #aaa",borderRadius:"1rem"},width:"800px",height:"600px",oncreate:t}),m("",{style:{display:"flex"}},[m(v,{isBtn:!0,color:"brown",ext:{onmousedown:i,onmouseup:e,ontouchstart:i,ontouchend:e}},"左移动"),m(v,{isBtn:!0,color:"brown",ext:{onmousedown:a,onmouseup:o,ontouchstart:a,ontouchend:o},style:{marginLeft:"auto"}},"右移动")])])}}}function kr(){return{view:function(){return m("","开发中")}}}var qt,si,Nt,Ot;si={default:oi,pet:br,robot:pi,racket:xr,tree:kr};dt.locale("zh-cn");Nt=function(r){var t,i;return i=Number(r),t=Date.now(),dt(i),t-i<=7*24*3600*1e3?dt(i).fromNow():dt(i).format("YYYY-MM-DD HH:mm:ss")};Ot=!1;const li=qt=function(){var r;return r="/home",{oninit:async function(t){var i,e;return M.readMode=2,e=t.attrs.self,r=(i=m.route.get().match(/\/home\/\d+/g))!=null?i[0]:void 0,t.attrs.pid&&(e.showMore=!0),e.contentType==="block"&&r===`/home/${e.pid}`&&(await t.state.method.showReply(t),e.showReply=!0),M.posts.init(e.pid)},data:{showMore:!1,avatarWidth:null,scrollToDom:null},method:{showReply:async function(t){var i;return i=t.attrs.self,i.showReply||(await i.pull(),M.posts.init(i.pid),await M.posts[i.pid].init(),i.contentType!=="block"&&(M.posts[i.pid].order="asc",await M.posts[i.pid].pull())),i.showReply=!i.showReply}},view:function(t){var i,e,n,a,o,s,d,h,l,c,u,w,f,k,x,b,R,C,X,$,g,E,N,H,j,K,Z,F,U,z,J,st,ft,pt,Dt,Tt,Ct,Bt,$t,Ht,ye,we,p;return i=this,p=t.attrs.self,h=t.attrs.parent,e=t.attrs,p.contentType==="block"&&(n=JSON.parse(p.content)),m("",{class:t.attrs.pid?"":"animated","data-key":p.pid,style:{flexBasis:p.showBlockMenu||p.showReply||p.contentType!=="block"?"100%":`${100/4}%`,maxWidth:"100%"}},[p.contentType==="block"?m(yr,{self:p,routeMatch:r,blockInfo:n,_this:this,Thread:qt,showName:Ot,v:t}):p.isTop>0&&`/home/${p.pid}`!==r?m(wr,{self:p,routeMatch:r,blockInfo:n,_this:this,Thread:qt,showName:Ot,v:t}):m("",[m("",{style:{display:"grid",gridTemplateColumns:M.readMode===1?"22% 1fr":void 0,margin:`2rem 1rem ${p.love_user&&p.love_user.length>0?0:"1rem"} 1rem`}},[m(".thread_left",{style:{textAlign:M.readMode===1?"center":void 0,display:M.readMode!==1?"grid":void 0,gridTemplateColumns:"8rem 1fr",gridTemplateRows:"4rem 4rem","grid-template-areas":`'a b'

'a c'`}},[m("",{style:{position:"relative",gridArea:"a",display:"flex",justifyContent:"center",alignItems:"center"}},[m($e,{oncreate:function({dom:O}){},source:"thread",sourceSelf:p,style:{width:M.readMode!==1?"5rem":Mob?"calc(100% - 2rem)":"calc(100% - 4rem)",paddingBottom:M.readMode!==1?"5rem":Mob?"calc(100% - 2rem)":"calc(100% - 4rem)"},src:p.contentType==="spiderRss"&&p.uid===1?"/statics/logo_avatar.svg":(l=(c=p.icat_users_extend)!=null?c.avatar:void 0)!=null?l:"/statics/default_avatar.jpg"})]),m("",{style:{gridArea:"b",display:M.readMode!==1?"flex":void 0,alignItems:"center"}},[m(T,{styleExt:{display:"inline-flex",alignItems:"center",margin:"0.2rem 0.1rem",padding:"0 1rem",borderRadius:"0.3rem",background:"transparent"},isBlock:M.readMode===1?!0:void 0},[p.contentType==="spiderRss"?p.author:($=p.icat_users_extend)!=null&&$.name?p.icat_users_extend.name:p.author]),m("",{style:{display:M.readMode!==1?"inline-block":void 0,fontSize:"1rem",color:"#aaa",background:"none",margin:0,padding:0,marginBottom:M.readMode!==1?"none":"0.5rem"}},`@${p.author}`),m("",{display:"flex",alignItems:"center",justifyContent:"center"},[m(ni,{user:p.icat_users_extend})]),m(T,{color:"none",styleExt:{padding:0},onclick:()=>(M.readMode=M.readMode===1?2:1,!1)},[M.readMode===2?m.trust(iconPark.getIcon("ToLeft",{theme:"outline",fill:"#666",size:"12px"})):void 0,M.readMode===1?m.trust(iconPark.getIcon("ToRight",{theme:"outline",fill:"#666",size:"12px"})):void 0])]),m("",{style:{gridArea:"c",display:"flex",alignItems:"center",flexDirection:M.readMode!==1?"row":"column"}},[m("",{style:{display:M.readMode===1?"inline-flex":"flex",justifyContent:"center",flexWrap:"wrap",padding:0}},[p.contentType==="spiderRss"?[m(T,{color:"gold"},"喵"),m(T,{color:"red"},"蛛")]:[m(T,{color:"gold"},"喵"),m(T,{color:"red"},"会"),p.icat_users_extend&&p.icat_users_extend.power>=80?80<=(J=p.icat_users_extend.power)&&J<90?m(T,{color:"deepBlue"},"版"):m(T,{color:"deepBlue"},"管"):void 0]]),m("",{style:{width:M.readMode===1?"80%":void 0,flex:1}},[m(gr,{self:p,goods:(Ct=p.icat_users_extend)!=null?Ct.icat_goods:void 0})])])]),m(".thread_right",{style:{flex:1,minWidth:0,boxShadow:"0 0 3rem rgba(5,5,5,0.05)",borderRadius:M.readMode!==1?"1.5rem":"2rem",border:(Bt=D.options)!=null&&Bt.get("global_styleBlackMode")?"0.2rem solid #333":void 0,outline:($t=D.options)!=null&&$t.get("global_styleBlackMode")?"0.4rem solid #000":void 0,overflow:"hidden",display:"flex",flexDirection:"column"}},[m(v,{isBlock:!0,style:{marginBottom:0,position:"relative",borderBottom:p.isTop>0?"solid 0.4rem #FFBB33":p.author===((Ht=y.user)!=null?Ht.user:void 0)?(ye=D.options)!=null&&ye.get("global_styleBlackMode")?"solid 0.4rem #000":"solid 0.4rem #65C4AD":(we=D.options)!=null&&we.get("global_styleBlackMode")?"solid 0.4rem #000":"solid 0.4rem #65C4AD",borderRadius:"0",display:"flex",alignItems:"center",margin:"0",padding:"1rem",background:(u=D.options)!=null&&u.get("global_styleBlackMode")?((w=D.options)!=null?w.get("global_theme"):void 0)===1?e.index%2!==0?A("blue").back:A("yellow").back:((f=D.options)!=null?f.get("global_theme"):void 0)===2?e.index%2!==0?A("gold").back:A("yellow").back:A("yellow").back:"rgba(29,19,16,0.7)",mixBlendMode:(k=D.options)!=null&&k.get("global_styleBlackMode")?"difference":"multiply"}},[void 0,m("",{style:{top:0,bottom:0,right:0,left:0,zIndex:-1}}),m(`a[href=#!/home/${p.pid}]`,{style:{textOverflow:"ellipsis",overflow:"hidden",wordBreak:"break-all",whiteSpace:"nowrap",color:(x=D.options)!=null&&x.get("global_styleBlackMode")?"#000":"#ddd",fontWeight:"bolder",margin:"0.5rem 0"},onclick:O=>(O.preventDefault(),ROUTE.set(`/home/${p.pid}`))},[m(ui,{self:p}),yt(p.title.slice(0,26)).replace(/<[^<>]+>/g,""),m(T,{onclick:()=>(S.launch({content:()=>({view:function(){return m("",[m(v,{isBtn:!0,onclick:()=>ROUTE.set(`/home/${p.pid}`)},"打开帖子"),m(v,{isBtn:!0,onclick:async()=>{var O;return O=location.origin+`/null-${p.pid}-null.html`,await navigator.clipboard.writeText(O),S.launch({msg:"链接已复制"})}},"复制链接")])}})}),!1)},[m.trust(iconPark.getIcon("LinkTwo",{size:"12px",fill:(b=D.options)!=null&&b.get("global_styleBlackMode")?["#eee","#eee","#eee","#eee"]:["#333","#333","#333","#333"]}))])]),m(T,{isBtn:!0,color:"none",styleExt:{margin:"0 0.1rem 0 auto"},onclick:()=>ROUTE.set(`/home/${p.linkid}`)},[p.linkid!==0&&`/home/${p.pid}`===r?m.trust(iconPark.getIcon("UpSmall",{fill:(R=D.options)!=null&&R.get("global_styleBlackMode")?["#000","#000","#000","#000"]:["#fff","#fff","#fff","#fff"]})):void 0]),p.uid===((C=y.user)!=null?C.uid:void 0)||((X=y.user)!=null?X.power:void 0)>=80?m(T,{isBtn:!0,color:"none",styleExt:{marginRight:0,position:"relative"},ext:{onclick:function(O){var be;return p.showMoreMenu=!p.showMoreMenu,p.showMoreMenu&&document.addEventListener("click",be=function(_r){return p.showMoreMenu=!1,m.redraw(),document.removeEventListener("click",be)}),O.stopPropagation()}}},[m("i",[m.trust(iconPark.getIcon("MoreOne",{fill:(g=D.options)!=null&&g.get("global_styleBlackMode")?["#000","#000","#000","#000"]:["#fff","#fff","#fff","#fff"]}))]),p.showMoreMenu?m(He,{self:p}):void 0]):void 0]),m(v,{isBlock:!0,style:{flexGrow:1,boxSizing:"content-box",minHeight:Mob?"10rem":"15rem",marginTop:(E=D.options)!=null&&E.get("global_styleBlackMode")?void 0:0,marginBottom:(N=D.options)!=null&&N.get("global_styleBlackMode")?void 0:0,borderRadius:"0",borderTop:"none",borderBottom:"none",margin:0,background:(H=D.options)!=null&&H.get("global_styleBlackMode")?"rgba(50,50,50,0.8)":"rgba(255,255,255,0.8)",display:"flex",flexDirection:"column",padding:"0 1rem"}},[m("",{style:{fontSize:"1rem",color:"#bbb",display:"flex",flexWrap:"wrap",padding:"1rem 0 0.5rem 0"}},[m("span",{style:{fontSize:"1rem"}},["编辑："+(Number(p.updateTimestamp)?Nt(Number(p.updateTimestamp)):Nt(p.finallyTime))]),m("span",{style:{fontSize:"1rem",marginLeft:"auto"}},["发布："+(Number(p.createTimestamp)?Nt(Number(p.createTimestamp)):Nt(p.createTime))])]),p.isPrivate>0?m("",[m(T,{color:"red",styleExt:{borderRadius:"0.3rem",marginLeft:0}},"阅读权限"),m(T,{color:"yellow",styleExt:{borderRadius:"0.3rem",marginLeft:0}},function(){switch(p.isPrivate){case 1:return"仅自己可见";case 2:return"仅上级可见";case 3:return"仅回复可见";case 4:return"仅回复和上级可见"}}())]):void 0,p.isHide<=0&&((j=p.icat_files)!=null?j[0]:void 0)!=null?m(di,{files:p.icat_files,isRound:!0}):void 0,[m("",{oncreate:function({dom:O}){return xe(O)},onupdate:function({dom:O}){return xe(O)}},[function(){if(pr("comp",p.content))try{return d=p.content.replace("{{{comp}}}","").trim(),o=JSON.parse(d),a=si[o.dir],p.title=o.name,m(a)}catch(O){return s=O,console.log(s),m(oi)}else return m("",{class:"article",style:{wordWrap:"break-word",overflow:"hidden",maxHeight:p.showMore?"none":"19rem"}},[p.showMore?m.trust(yt(p.content,p.contentType)):m.trust(yt(p.content,p.contentType,{mini:!0}))])}()])],(K=p.icat_users_extend)!=null&&K.introduction?m("",{style:{color:"#666",fontSize:"1rem",borderTop:(Z=D.options)!=null&&Z.get("global_styleBlackMode")?`0.1rem dashed ${A("blue").back}`:`0.1rem dashed ${A("deepBlue").back}`,borderRadius:"1rem",padding:"0.5rem 1rem",background:(F=D.options)!=null&&F.get("global_styleBlackMode")?"rgba(15,15,15,0.5)":"rgba(240,240,240,0.5)",margin:"2rem 0 1rem 0",marginTop:"auto"}},[m("",{style:{fontSize:"1rem",color:(U=D.options)!=null&&U.get("global_styleBlackMode")?`${A("blue").back}`:`${A("deepBlue").back}`}},">>> 签名栏"),m(".article.sign",{style:{fontSize:"1rem"}},m.trust(yt(p.icat_users_extend.introduction,"bbcode")))]):void 0,p.isHide<=0&&((z=p.icat_files)!=null?z[0]:void 0)!=null?m("",{style:{marginTop:"auto"}},[m(mi,{files:(st=p.icat_files)!=null?st.filter(O=>!O.type.match(/image/g)):void 0})]):void 0]),m(v,{isBlock:!0,style:{margin:"0",display:"flex",justifyContent:"flex-end",alignItems:"center",flexWrap:"wrap",borderRadius:"0",position:"relative","backdrop-filter":"blur(5px)","-webkit-backdrop-filter":"blur(5px)",background:(ft=D.options)!=null&&ft.get("global_styleBlackMode")?"rgba(0,0,0,0.5)":"rgba(223, 223, 223, 0.5)",borderTop:"none"}},[p.content.length>40||p.icat_files&&p.icat_files.length>0?m(T,{isBtn:!0,color:"none",styleExt:{display:"inline-flex",justifyContent:"center",alignItems:"center",color:"#888",marginRight:"auto"},onclick:function(){return p.showMore=!p.showMore}},[p.showMore?[m.trust(iconPark.getIcon("DoubleUp",{theme:"outline",fill:"#888"})),"收起Wiu"]:[m.trust(iconPark.getIcon("DoubleDown",{theme:"outline",fill:"#888"})),"展开Biu"]]):void 0,m(ze,{self:p,parent:h,freshType:"thread"}),p.replyCalc>0?m(T,{color:p.showReply?"sliver":"none",isBtn:!0,onclick:function(){return i.method.showReply(t)},styleExt:{display:"inline-flex",flexDirection:"column",justifyContent:"center",margin:"0.2rem"}},[m("i",{style:{color:p.showReply?void 0:"#43599A",verticalAlign:"top"}},[m.trust(iconPark.getIcon("Comments",{theme:"outline",fill:"#888"})),Ot?void 0:m("span",{style:{fontSize:"1rem",color:"#888",margin:"0.5rem"}},p.replyCalc)]),Ot?(m("span",{style:{verticalAlign:"top",fontSize:"1rem",color:"#888"}}),`评论(${p.replyCalc})`):void 0]):void 0])])]),m(fi,{self:p}),m("",[p.showReply?m(`#reply${p.pid}`,{style:{display:"block",whiteSpace:"nowrap",overflow:"auto"},oncreate:({dom:O})=>this.data.scrollToDom=O},[(pt=M.posts[t.attrs.self.pid])!=null?pt.getPage().map(O=>m(ue,{key:O.pid,self:O,parent:p,isThread:!0,threadId:p.pid})):void 0]):void 0]),(Dt=M.posts[t.attrs.self.pid])!=null&&Dt.data[0]&&p.showReply?[m(Mt,{rows:M.posts[p.pid],type:"thread",scrollToDom:this.data.scrollToDom}),m(v,{isBlock:!0,isBtn:!0,onclick:function(){return i.method.showReply(t)},style:{boxShadow:"0 0 1rem rgba(3,3,3,0.05)",color:"#888",borderRadius:"2rem",background:(Tt=D.options)!=null&&Tt.get("global_styleBlackMode")?"rgba(0,0,0,0.5)":"rgba(215,215,215,0.3)",backdropFilter:"blur(10px)","-webkit-backdrop-filter":"blur(10px)"}},`${p.showReply?"( ๑ŏ ﹏ ŏ๑ )":"|･ω･｀)"}`)]:void 0])])}}},Mr={oninit:async function(){var r;try{return M.user.init(y.user.uid),await M.user[y.user.uid].init(),m.redraw()}catch(t){return r=t,console.log(r)}},view:function(){return m("",[M.user[y.user.uid].data[0]?m("",[M.user[y.user.uid].getPage().map(r=>r.contentType==="block"?m(li,{self:r,key:r.pid}):m(ue,{self:r,key:r.pid,isThread:!0,isUser:!0}))]):m("",{style:{background:"rgba(215,215,215,0.3)",backdropFilter:"blur(10px)","-webkit-backdrop-filter":"blur(10px)",height:"20rem",width:"100%",display:"flex",justifyContent:"center",alignItems:"center",fontSize:"2rem",borderRadius:"2rem"}},"┭┮﹏┭┮，还没有帖子哦"),m(Mt,{rows:M.user[y.user.uid]})])}};function Dr(){var r,t;return t=[],r=5,{oninit:async function(){return t=await Q.get("likeSays")||[],m.redraw()},view:function({attrs:i}){return m("",[m("",{style:{display:"flex",flexDirection:"column"}},[t.slice(0,+r+1||9e9).map(e=>m(v,{tagName:".animated.flipInX",style:{display:"flex",borderLeft:`0.3rem solid ${A("red").back}`}},[m(v,e.say),m(v,"——"+e.from),m(v,{isBtn:!0,color:"red",style:{marginLeft:"auto"},onclick:()=>S.launch({msg:"确定删除吗？删除后不可恢复哦",confirm:async()=>{var n;try{t=await Q.get("likeSays"),t=t.filter(a=>a.say!==e.say),t=await Q.set("likeSays",t);return}catch(a){return n=a,console.log(n)}}})},"删除")]))]),m(v,{isBtn:!0,isBlock:!0,onclick:()=>r>t.length?r=t.length:r+=5},t.length===r?"到底啦":"加载更多")])}}}dt.locale("zh-cn");function Tr(){return{oninit:async function(){var r;try{return y.initMyCredits(),await y.myCredits.init(),await y.myCredits.pull(),await y.getCreditsTotals()}catch(t){return r=t,console.dir(r)}},view:function({attrs:r}){var t,i;return m("",[m("",{style:{display:"grid",gridTemplateColumns:Mob?"repeat(3,1fr)":"repeat(6,1fr)"}},[(t=y.creditsTotals)!=null?t.map(e=>{if(e)return m(v,{style:{display:"flex",alignItems:"center"}},[m(T,{color:"red",styleExt:{margin:0,borderRadius:"0.5rem"}},e.creditName),m(T,e.totalCalc)])}):void 0]),m(v,{isBtn:!0,onclick:async()=>{var e;try{return await y.getCreditsTotals(),S.launch({msg:"获取完毕"})}catch(n){return e=n,console.dir(e)}}},"点击更新积分信息"),m("",{style:{display:"flex",flexDirection:"column"}},[(i=y.myCredits)!=null?i.getPage().map(e=>m(v,{tagName:".animated",style:{display:"flex",borderLeft:e.freeze===0?`0.3rem solid ${A("red").back}`:`0.3rem solid ${A("deepBlue").back}`}},[m(v,e.creditName),m(v,e.calc>0?`+${e.calc}`:e.calc),m(v,e.action),e.payPlatform?m(v,e.payPlatform):void 0,m(v,e.freeze===0?"未冻结":"!已冻结"),m(v,dt(e.timestamp*1).format("YYYY-MM-DD HH:mm:ss"))])):void 0]),m(Mt,{rows:y.myCredits})])}}}const Cr={oninit:async function(){var r;try{return y.initCdkeys(),await y.cdkeys.init(),y.cdkeys.order="desc",await y.cdkeys.pull()}catch(t){return r=t,console.log(r)}},view:function(){return m("",[m("",{style:{display:"grid",gridTemplateColumns:"auto auto auto"}},[["名称","类型","数据"].map(r=>m(v,{color:"brown"},r)),y.cdkeys.getPage().length<1?m(v,"暂无数据"):void 0,y.cdkeys.getPage().map(r=>m.fragment({key:r.cdkeyid},[m(v,r.name),m(v,r.type),m(v,r.value)]))]),m(Mt,{rows:y.cdkeys})])}},Br={oninit:async function(){var r;try{return M.stars.init(y.user.uid),await M.stars.list.init(),await M.stars.list.pull()}catch(t){return r=t,console.log(r)}},view:function(){var r,t;return m("",[(r=M.stars.list)!=null&&r.data[0]?m("",[(t=M.stars.list)!=null?t.getPage().map(i=>i.contentType==="block"?m(li,{self:i,key:i.pid}):m(ue,{self:i,key:i.pid,isThread:!0,isUser:!0})):void 0]):m("",{style:{height:"20rem",width:"100%",display:"flex",justifyContent:"center",alignItems:"center",fontSize:"2rem",borderRadius:"1rem",background:"rgba(215,215,215,0.3)",backdropFilter:"blur(10px)","-webkit-backdrop-filter":"blur(10px)"}},"┭┮﹏┭┮，还没有帖子哦"),m(Mt,{rows:M.stars.list})])}};function Er(){return{view:function({attrs:r}){return m("",[m("",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(15rem, 1fr)"}},[m(v,{isBtn:!0,onclick:()=>S.launch({tip:"委托中心",content:gi})},"委托中心"),m(v,{isBtn:!0,onclick:()=>S.launch({tip:"商店",content:vi})},"商店"),m(v,{isBtn:!0,onclick:()=>S.launch({tip:"物品",content:yi})},"我的物品"),m(v,{isBtn:!0,onclick:()=>ROUTE.set("/gameEditor")},"RPG设计器")])])}}}var ce,ht,he,ut,at,At,ci;ut=ve();he=v();ce=v();ht=v();At=!1;at="头像修改";ci=["头像修改","个人资料","密码修改","邮箱绑定","积分充值"];function Rr(){return{oninit:async function(){var r;try{return await y.initMyInfos(),await y.myInfos.init(),await y.myInfos.pull(),console.log(y.myInfos)}catch(t){return r=t,console.log(r)}},view:function({attrs:r}){var t,i,e,n,a;return m("",[ci.map(o=>m(T,{color:at===o?"red":void 0,isBtn:!0,onclick:()=>at=o},o)),m("",[at==="密码修改"?m("form",{style:{display:"grid",gridTemplateColumns:"1fr 2fr",margin:"1rem 0"}},[((t=y.user)!=null?t.emailVerify:void 0)===0?[m(v,"旧密码"),m(he,{tagName:"input[type=password]"})]:void 0,m(v,"新密码"),m(ce,{tagName:"input[type=password]"}),m(v,"再次输入新密码"),m(ht,{tagName:"input[type=password]",ext:{oninput:o=>(ht.data.value=o.target.value,ce.data.value===ht.data.value?At=!0:At=!1)}}),m("",[m(v,{color:((i=y.user)!=null?i.emailVerify:void 0)===1&&!localStorage.token?"yellow":"red",isBtn:!0,onclick:async()=>{var o;if(At){if(((o=y.user)!=null?o.emailVerify:void 0)===0)return await y.resetPassword(he.data.value,ht.data.value);if(localStorage.token){if(await y.resetPasswordToken(ht.data.value,localStorage.token))return r.delete()}else return S.launch({hideBtn:4,content:function(){var s;return s=ve(),{view:function(d){return m("",[m(s,{sendClick:async()=>{var h,l;try{return l=await m.request({withCredentials:!0,url:`${apiHost}/api/auth/center`,method:"post",body:{}}),S.launch({msg:l.msg})}catch(c){return h=c,console.dir(h)}},verifyClick:async()=>{var h,l;try{if(l=await m.request({withCredentials:!0,url:`${apiHost}/api/auth/center`,method:"post",body:{code:s.data.emailCode.data.value,token:localStorage.token}}),S.launch({msg:l.msg}),l.data)return localStorage.token=l.data,d.attrs.delete()}catch(c){return h=c,console.dir(h)}}})])}}}})}else return S.launch({msg:"两次输入的密码不一致"})}},((e=y.user)!=null?e.emailVerify:void 0)===1&&!localStorage.token?"验证":"提交")]),ht.data.value.length>0&&At===!1?m(v,{style:{color:A("red").back}},"*密码不一致"):m("","")]):void 0,at==="头像修改"?m("",{style:{margin:"1rem 0"}},[m(ri)]):void 0,at==="邮箱绑定"?m(ut,{isBind:!0,sendClick:async()=>{var o,s,d,h,l;if(s=ut.data.emailTime,o=ut.data.emailAddress,d=ut.emailTimer,!(s>0)){if(h=Joi.string().email({tlds:{allow:!1}}).pattern(/^(\w+@(vip\.){0,1}qq\.com)|(\w+@foxmail\.com)$/),h.validate(o.data.value).error)return S.launch({msg:"邮箱地址不合法（目前仅支持QQ邮箱哦）"});if(l=await y.bindEmail(o.data.value),s===0&&l==="邮件已发送")return s=19,d=setInterval(()=>{if(s--,m.redraw(),s<0)return s=0,clearInterval(d),d=null},1e3)}},verifyClick:async()=>{var o,s;return o=ut.data.emailAddress,s=ut.data.emailCode,await y.bindEmail(o.data.value,s.data.value)}}):void 0,at==="积分充值"?m(wi):void 0,at==="个人资料"?m("",[m(bi,{isSetting:!0,myInfo:(n=y.myInfos)!=null&&(a=n.data)!=null?a[0]:void 0,myInfos:y.myInfos})]):void 0])])}}}function Sr(){return{view:function({attrs:r}){return m("",{style:{display:"inline-flex",alignItems:"center"}},[r.user.name?r.user.name+`(${r.user.user})`:r.user.user,m(ni,{user:r.user})])}}}var tt;tt={say:"...正在加载一言...",from:"",fromWho:"",time:0};function Ir(){return{oninit:async function(){var r,t;if(Date.now()-tt.time>=60*1e3)try{return t=await m.request({method:"get",url:"https://v1.hitokoto.cn/"}),tt.say=t.hitokoto,tt.from=t.from,tt.fromWho=t.fromWho,tt.time=Date.now()}catch(i){return r=i,console.dir(r)}},view:function(){var r,t,i;return m("",[m("",{style:{backgroundColor:(t=D.options)!=null&&t.get("global_styleBlackMode")?"rgba(0,0,0,0.5)":"rgba(235,235,235,0.3)",borderRadius:Mob?void 0:"10rem",backgroundSize:"cover",display:"flex",justifyContent:"center",alignItems:"center",marginBottom:"1rem",flexDirection:"column","-webkit-backdrop-filter":"blur(5px)",backdropFilter:"blur(5px)",margin:"1rem auto"}},[m("",{onclick:function(e){if(e.stopPropagation(),!!y.isLogined())return S.launch({content:ri,hideBtn:1})},style:{marginTop:"5rem",width:"10rem",height:"10rem",borderRadius:"50%",backgroundImage:`url(${transUrl(y.user.avatar)||"./statics/default_avatar.jpg"})`,backgroundSize:"100%",cursor:"pointer"}}),m("",{style:{marginTop:"1rem",fontSize:"1.6rem"}},[`${xi()},`,m(Sr,{user:y.user})]),m("",{style:{marginTop:"1rem"}},[m(T,{color:"red",isBtn:!0,onclick:async()=>await y.exit()},"退出登录"),m(T,{color:"yellow",isBtn:!0,onclick:()=>S.launch({tip:"个人设置",content:Rr,hideBtn:!0})},"个人设置"),m(T,{isBtn:!0,onclick:async()=>{var e,n;try{return n=D.options.data.find(a=>a.key==="global_styleBlackMode"),await Q.set("blackMode",n.value?0:1),await y.syncBlackMode()}catch(a){return e=a,console.log(e)}}},y.blackMode?"浅色模式":"酷黑模式")]),m("",{style:{margin:"1rem",background:"none",color:"#666",display:"flex",alignItems:"center"}},[m("span",{style:{fontSize:"1.3rem",fontStyle:"italic",color:(i=D.options)!=null&&i.get("global_styleBlackMode")?"#bbb":void 0}},`${tt.say} ${tt.from?`——${tt.from}`:void 0}`),m(fr,{oneSay:tt})])]),m(ki,[m("",{style:{margin:"1rem"}},[y.tabs.map((e,n)=>m("",{style:{margin:"0 0.5rem",display:"inline-block",fontSize:n===y.tabIndex?"3rem":"2rem",transition:"all 0.5s ease",cursor:"pointer"},onclick:function(){return y.tabIndex=n}},e))]),(r=y.tabs[y.tabIndex])==="发表"?m(Mr):r==="一言"?m(Dr):r==="积分"?m(Tr):r==="点卡"?m(Cr):r==="收藏"?m(Br):r==="功能"?m(Er):void 0])])}}}function Or(){return{view:function(){return y.user?m(Ir):m("",{style:{height:"100%"}},[m(mr)])}}}export{Or as default};
